var Ue={},qs=(pt,F,Ds)=>(Ue.__chunk_3826=(Ve,ye,U)=>{"use strict";U.d(ye,{U:()=>ie});var oe=U(4863),le=U(1326);async function ie(){let he=await(0,le.UL)();return(0,oe.createServerClient)("https://elhlcdiosomutugpneoc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVsaGxjZGlvc29tdXR1Z3BuZW9jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5MDU3NTMsImV4cCI6MjA3NDQ4MTc1M30.d92ZJG5E_9r7bOlRLBXRI6gcB_7ERVbL-Elp7fk4avY",{cookies:{get:te=>he.get(te)?.value,set(te,fe,we){try{he.set({name:te,value:fe,...we})}catch{}},remove(te,fe){try{he.set({name:te,value:"",...fe})}catch{}}}})}},Ue.__chunk_7895=(Ve,ye,U)=>{let oe;function le(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&0>e.indexOf(s)&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(r);i<s.length;i++)0>e.indexOf(s[i])&&Object.prototype.propertyIsEnumerable.call(r,s[i])&&(t[s[i]]=r[s[i]]);return t}U.d(ye,{UU:()=>$s}),typeof SuppressedError=="function"&&SuppressedError;class ie extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class he extends ie{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class te extends ie{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class fe extends ie{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}(V=I||(I={})).Any="any",V.ApNortheast1="ap-northeast-1",V.ApNortheast2="ap-northeast-2",V.ApSouth1="ap-south-1",V.ApSoutheast1="ap-southeast-1",V.ApSoutheast2="ap-southeast-2",V.CaCentral1="ca-central-1",V.EuCentral1="eu-central-1",V.EuWest1="eu-west-1",V.EuWest2="eu-west-2",V.EuWest3="eu-west-3",V.SaEast1="sa-east-1",V.UsEast1="us-east-1",V.UsWest1="us-west-1",V.UsWest2="us-west-2";class we{constructor(e,{headers:t={},customFetch:s,region:i=I.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=(n=>n?(...a)=>n(...a):(...a)=>fetch(...a))(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){var t,s,i,n;return t=this,s=arguments,i=void 0,n=function*(a,o={}){var l;let h,u;try{let c,{headers:d,method:p,body:f,signal:y,timeout:g}=o,O={},{region:v}=o;v||(v=this.region);let K=new URL(`${this.url}/${a}`);v&&v!=="any"&&(O["x-region"]=v,K.searchParams.set("forceFunctionRegion",v)),f&&(d&&!Object.prototype.hasOwnProperty.call(d,"Content-Type")||!d)?"u">typeof Blob&&f instanceof Blob||f instanceof ArrayBuffer?(O["Content-Type"]="application/octet-stream",c=f):typeof f=="string"?(O["Content-Type"]="text/plain",c=f):"u">typeof FormData&&f instanceof FormData?c=f:(O["Content-Type"]="application/json",c=JSON.stringify(f)):c=!f||typeof f=="string"||"u">typeof Blob&&f instanceof Blob||f instanceof ArrayBuffer||"u">typeof FormData&&f instanceof FormData?f:JSON.stringify(f);let b=y;g&&(u=new AbortController,h=setTimeout(()=>u.abort(),g),y?(b=u.signal,y.addEventListener("abort",()=>u.abort())):b=u.signal);let W=yield this.fetch(K.toString(),{method:p||"POST",headers:Object.assign(Object.assign(Object.assign({},O),this.headers),d),body:c,signal:b}).catch(Ee=>{throw new he(Ee)}),q=W.headers.get("x-relay-error");if(q&&q==="true")throw new te(W);if(!W.ok)throw new fe(W);let se=((l=W.headers.get("Content-Type"))!=null?l:"text/plain").split(";")[0].trim();return{data:se==="application/json"?yield W.json():se==="application/octet-stream"||se==="application/pdf"?yield W.blob():se==="text/event-stream"?W:se==="multipart/form-data"?yield W.formData():yield W.text(),error:null,response:W}}catch(c){return{data:null,error:c,response:c instanceof fe||c instanceof te?c.context:void 0}}finally{h&&clearTimeout(h)}},new(i||(i=Promise))(function(a,o){function l(c){try{u(n.next(c))}catch(d){o(d)}}function h(c){try{u(n.throw(c))}catch(d){o(d)}}function u(c){var d;c.done?a(c.value):((d=c.value)instanceof i?d:new i(function(p){p(d)})).then(l,h)}u((n=n.apply(t,s||[])).next())})}}var V,ue,M,X,L,m,P,E,w,R,I,T,_,j,B,S,x,N,A,Z,J,pe=class extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}},G=class{constructor(r){var e,t;this.shouldThrowOnError=!1,this.method=r.method,this.url=r.url,this.headers=new Headers(r.headers),this.schema=r.schema,this.body=r.body,this.shouldThrowOnError=(e=r.shouldThrowOnError)!=null&&e,this.signal=r.signal,this.isMaybeSingle=(t=r.isMaybeSingle)!=null&&t,r.fetch?this.fetch=r.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(r,e){return this.headers=new Headers(this.headers),this.headers.set(r,e),this}then(r,e){var t=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var n,a,o,l;let h=null,u=null,c=null,d=i.status,p=i.statusText;if(i.ok){if(t.method!=="HEAD"){let g=await i.text();g===""||(u=t.headers.get("Accept")==="text/csv"||t.headers.get("Accept")&&((o=t.headers.get("Accept"))==null?void 0:o.includes("application/vnd.pgrst.plan+text"))?g:JSON.parse(g))}let f=(n=t.headers.get("Prefer"))==null?void 0:n.match(/count=(exact|planned|estimated)/),y=(a=i.headers.get("content-range"))==null?void 0:a.split("/");f&&y&&y.length>1&&(c=parseInt(y[1])),t.isMaybeSingle&&t.method==="GET"&&Array.isArray(u)&&(u.length>1?(h={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,c=null,d=406,p="Not Acceptable"):u=u.length===1?u[0]:null)}else{let f=await i.text();try{h=JSON.parse(f),Array.isArray(h)&&i.status===404&&(u=[],h=null,d=200,p="OK")}catch{i.status===404&&f===""?(d=204,p="No Content"):h={message:f}}if(h&&t.isMaybeSingle&&(h==null||(l=h.details)==null?void 0:l.includes("0 rows"))&&(h=null,d=200,p="OK"),h&&t.shouldThrowOnError)throw new pe(h)}return{error:h,data:u,count:c,status:d,statusText:p}});return this.shouldThrowOnError||(s=s.catch(i=>{var n,a,o,l,h,u;let c="",d=i?.cause;if(d){let p=(a=d?.message)!=null?a:"",f=(o=d?.code)!=null?o:"";c=`${(l=i?.name)!=null?l:"FetchError"}: ${i?.message}

Caused by: ${(h=d?.name)!=null?h:"Error"}: ${p}`,f&&(c+=` (${f})`),d?.stack&&(c+=`
${d.stack}`)}else c=(u=i?.stack)!=null?u:"";return{error:{message:`${(n=i?.name)!=null?n:"FetchError"}: ${i?.message}`,details:c,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),s.then(r,e)}returns(){return this}overrideTypes(){return this}},Te=class extends G{select(r){let e=!1,t=(r??"*").split("").map(s=>/\s/.test(s)&&!e?"":(s==='"'&&(e=!e),s)).join("");return this.url.searchParams.set("select",t),this.headers.append("Prefer","return=representation"),this}order(r,{ascending:e=!0,nullsFirst:t,foreignTable:s,referencedTable:i=s}={}){let n=i?`${i}.order`:"order",a=this.url.searchParams.get(n);return this.url.searchParams.set(n,`${a?`${a},`:""}${r}.${e?"asc":"desc"}${t===void 0?"":t?".nullsfirst":".nullslast"}`),this}limit(r,{foreignTable:e,referencedTable:t=e}={}){let s=t===void 0?"limit":`${t}.limit`;return this.url.searchParams.set(s,`${r}`),this}range(r,e,{foreignTable:t,referencedTable:s=t}={}){let i=s===void 0?"offset":`${s}.offset`,n=s===void 0?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${r}`),this.url.searchParams.set(n,`${e-r+1}`),this}abortSignal(r){return this.signal=r,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:r=!1,verbose:e=!1,settings:t=!1,buffers:s=!1,wal:i=!1,format:n="text"}={}){var a;let o=[r?"analyze":null,e?"verbose":null,t?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),l=(a=this.headers.get("Accept"))!=null?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${n}; for="${l}"; options=${o};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(r){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${r}`),this}};let be=RegExp("[,()]");var me=class extends Te{eq(r,e){return this.url.searchParams.append(r,`eq.${e}`),this}neq(r,e){return this.url.searchParams.append(r,`neq.${e}`),this}gt(r,e){return this.url.searchParams.append(r,`gt.${e}`),this}gte(r,e){return this.url.searchParams.append(r,`gte.${e}`),this}lt(r,e){return this.url.searchParams.append(r,`lt.${e}`),this}lte(r,e){return this.url.searchParams.append(r,`lte.${e}`),this}like(r,e){return this.url.searchParams.append(r,`like.${e}`),this}likeAllOf(r,e){return this.url.searchParams.append(r,`like(all).{${e.join(",")}}`),this}likeAnyOf(r,e){return this.url.searchParams.append(r,`like(any).{${e.join(",")}}`),this}ilike(r,e){return this.url.searchParams.append(r,`ilike.${e}`),this}ilikeAllOf(r,e){return this.url.searchParams.append(r,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(r,e){return this.url.searchParams.append(r,`ilike(any).{${e.join(",")}}`),this}regexMatch(r,e){return this.url.searchParams.append(r,`match.${e}`),this}regexIMatch(r,e){return this.url.searchParams.append(r,`imatch.${e}`),this}is(r,e){return this.url.searchParams.append(r,`is.${e}`),this}isDistinct(r,e){return this.url.searchParams.append(r,`isdistinct.${e}`),this}in(r,e){let t=Array.from(new Set(e)).map(s=>typeof s=="string"&&be.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(r,`in.(${t})`),this}notIn(r,e){let t=Array.from(new Set(e)).map(s=>typeof s=="string"&&be.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(r,`not.in.(${t})`),this}contains(r,e){return typeof e=="string"?this.url.searchParams.append(r,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(r,`cs.{${e.join(",")}}`):this.url.searchParams.append(r,`cs.${JSON.stringify(e)}`),this}containedBy(r,e){return typeof e=="string"?this.url.searchParams.append(r,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(r,`cd.{${e.join(",")}}`):this.url.searchParams.append(r,`cd.${JSON.stringify(e)}`),this}rangeGt(r,e){return this.url.searchParams.append(r,`sr.${e}`),this}rangeGte(r,e){return this.url.searchParams.append(r,`nxl.${e}`),this}rangeLt(r,e){return this.url.searchParams.append(r,`sl.${e}`),this}rangeLte(r,e){return this.url.searchParams.append(r,`nxr.${e}`),this}rangeAdjacent(r,e){return this.url.searchParams.append(r,`adj.${e}`),this}overlaps(r,e){return typeof e=="string"?this.url.searchParams.append(r,`ov.${e}`):this.url.searchParams.append(r,`ov.{${e.join(",")}}`),this}textSearch(r,e,{config:t,type:s}={}){let i="";s==="plain"?i="pl":s==="phrase"?i="ph":s==="websearch"&&(i="w");let n=t===void 0?"":`(${t})`;return this.url.searchParams.append(r,`${i}fts${n}.${e}`),this}match(r){return Object.entries(r).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(r,e,t){return this.url.searchParams.append(r,`not.${e}.${t}`),this}or(r,{foreignTable:e,referencedTable:t=e}={}){let s=t?`${t}.or`:"or";return this.url.searchParams.append(s,`(${r})`),this}filter(r,e,t){return this.url.searchParams.append(r,`${e}.${t}`),this}},D=class{constructor(r,{headers:e={},schema:t,fetch:s}){this.url=r,this.headers=new Headers(e),this.schema=t,this.fetch=s}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(r,e){let{head:t=!1,count:s}=e??{},i=!1,n=(r??"*").split("").map(l=>/\s/.test(l)&&!i?"":(l==='"'&&(i=!i),l)).join(""),{url:a,headers:o}=this.cloneRequestState();return a.searchParams.set("select",n),s&&o.append("Prefer",`count=${s}`),new me({method:t?"HEAD":"GET",url:a,headers:o,schema:this.schema,fetch:this.fetch})}insert(r,{count:e,defaultToNull:t=!0}={}){var s;let{url:i,headers:n}=this.cloneRequestState();if(e&&n.append("Prefer",`count=${e}`),t||n.append("Prefer","missing=default"),Array.isArray(r)){let a=r.reduce((o,l)=>o.concat(Object.keys(l)),[]);if(a.length>0){let o=[...new Set(a)].map(l=>`"${l}"`);i.searchParams.set("columns",o.join(","))}}return new me({method:"POST",url:i,headers:n,schema:this.schema,body:r,fetch:(s=this.fetch)!=null?s:fetch})}upsert(r,{onConflict:e,ignoreDuplicates:t=!1,count:s,defaultToNull:i=!0}={}){var n;let{url:a,headers:o}=this.cloneRequestState();if(o.append("Prefer",`resolution=${t?"ignore":"merge"}-duplicates`),e!==void 0&&a.searchParams.set("on_conflict",e),s&&o.append("Prefer",`count=${s}`),i||o.append("Prefer","missing=default"),Array.isArray(r)){let l=r.reduce((h,u)=>h.concat(Object.keys(u)),[]);if(l.length>0){let h=[...new Set(l)].map(u=>`"${u}"`);a.searchParams.set("columns",h.join(","))}}return new me({method:"POST",url:a,headers:o,schema:this.schema,body:r,fetch:(n=this.fetch)!=null?n:fetch})}update(r,{count:e}={}){var t;let{url:s,headers:i}=this.cloneRequestState();return e&&i.append("Prefer",`count=${e}`),new me({method:"PATCH",url:s,headers:i,schema:this.schema,body:r,fetch:(t=this.fetch)!=null?t:fetch})}delete({count:r}={}){var e;let{url:t,headers:s}=this.cloneRequestState();return r&&s.append("Prefer",`count=${r}`),new me({method:"DELETE",url:t,headers:s,schema:this.schema,fetch:(e=this.fetch)!=null?e:fetch})}},H=class vr{constructor(e,{headers:t={},schema:s,fetch:i}={}){this.url=e,this.headers=new Headers(t),this.schemaName=s,this.fetch=i}from(e){if(!e||typeof e!="string"||e.trim()==="")throw Error("Invalid relation name: relation must be a non-empty string.");return new D(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new vr(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:i=!1,count:n}={}){var a;let o,l,h=new URL(`${this.url}/rpc/${e}`),u=p=>p!==null&&typeof p=="object"&&(!Array.isArray(p)||p.some(u)),c=s&&Object.values(t).some(u);c?(o="POST",l=t):s||i?(o=s?"HEAD":"GET",Object.entries(t).filter(([p,f])=>f!==void 0).map(([p,f])=>[p,Array.isArray(f)?`{${f.join(",")}}`:`${f}`]).forEach(([p,f])=>{h.searchParams.append(p,f)})):(o="POST",l=t);let d=new Headers(this.headers);return c?d.set("Prefer",n?`count=${n},return=minimal`:"return=minimal"):n&&d.set("Prefer",`count=${n}`),new me({method:o,url:h,headers:d,schema:this.schemaName,body:l,fetch:(a=this.fetch)!=null?a:fetch})}};class z{static detectEnvironment(){var e;if("u">typeof WebSocket)return{type:"native",constructor:WebSocket};if("u">typeof F&&F.WebSocket!==void 0)return{type:"native",constructor:F.WebSocket};if(U.g!==void 0&&U.g.WebSocket!==void 0)return{type:"native",constructor:U.g.WebSocket};if("u">typeof F&&F.WebSocketPair!==void 0&&F.WebSocket===void 0)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("u">typeof F&&F.EdgeRuntime||"u">typeof navigator&&((e=navigator.userAgent)==null?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};let t=F.process;if(t){let s=t.versions;if(s&&s.node){let i=parseInt(s.node.replace(/^v/,"").split(".")[0]);return i>=22?F.WebSocket!==void 0?{type:"native",constructor:F.WebSocket}:{type:"unsupported",error:`Node.js ${i} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${i} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){let e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{let e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}let Q="1.0.0";(ue=T||(T={}))[ue.connecting=0]="connecting",ue[ue.open=1]="open",ue[ue.closing=2]="closing",ue[ue.closed=3]="closed",(M=_||(_={})).closed="closed",M.errored="errored",M.joined="joined",M.joining="joining",M.leaving="leaving",(X=j||(j={})).close="phx_close",X.error="phx_error",X.join="phx_join",X.reply="phx_reply",X.leave="phx_leave",X.access_token="access_token",(B||(B={})).websocket="websocket",(L=S||(S={})).Connecting="connecting",L.Open="open",L.Closing="closing",L.Closed="closed";class Y{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,t){return e.event!==this.BROADCAST_EVENT||e.payload instanceof ArrayBuffer||typeof e.payload.event!="string"?t(JSON.stringify([e.join_ref,e.ref,e.topic,e.event,e.payload])):t(this._binaryEncodeUserBroadcastPush(e))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)==null?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,s;let i=(s=(t=e.payload)==null?void 0:t.payload)!=null?s:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,i)}_encodeJsonUserBroadcastPush(e){var t,s;let i=(s=(t=e.payload)==null?void 0:t.payload)!=null?s:{},n=new TextEncoder().encode(JSON.stringify(i)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,n)}_encodeUserBroadcastPush(e,t,s){let i=e.topic,n=(f=e.ref)!=null?f:"",a=(y=e.join_ref)!=null?y:"",o=e.payload.event,l=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},h=Object.keys(l).length===0?"":JSON.stringify(l);if(a.length>255)throw Error(`joinRef length ${a.length} exceeds maximum of 255`);if(n.length>255)throw Error(`ref length ${n.length} exceeds maximum of 255`);if(i.length>255)throw Error(`topic length ${i.length} exceeds maximum of 255`);if(o.length>255)throw Error(`userEvent length ${o.length} exceeds maximum of 255`);if(h.length>255)throw Error(`metadata length ${h.length} exceeds maximum of 255`);let u=this.USER_BROADCAST_PUSH_META_LENGTH+a.length+n.length+i.length+o.length+h.length,c=new ArrayBuffer(this.HEADER_LENGTH+u),d=new DataView(c),p=0;d.setUint8(p++,this.KINDS.userBroadcastPush),d.setUint8(p++,a.length),d.setUint8(p++,n.length),d.setUint8(p++,i.length),d.setUint8(p++,o.length),d.setUint8(p++,h.length),d.setUint8(p++,t),Array.from(a,O=>d.setUint8(p++,O.charCodeAt(0))),Array.from(n,O=>d.setUint8(p++,O.charCodeAt(0))),Array.from(i,O=>d.setUint8(p++,O.charCodeAt(0))),Array.from(o,O=>d.setUint8(p++,O.charCodeAt(0))),Array.from(h,O=>d.setUint8(p++,O.charCodeAt(0)));var f,y,g=new Uint8Array(c.byteLength+s.byteLength);return g.set(new Uint8Array(c),0),g.set(new Uint8Array(s),c.byteLength),g.buffer}decode(e,t){if(this._isArrayBuffer(e))return t(this._binaryDecode(e));if(typeof e=="string"){let[s,i,n,a,o]=JSON.parse(e);return t({join_ref:s,ref:i,topic:n,event:a,payload:o})}return t({})}_binaryDecode(e){let t=new DataView(e),s=t.getUint8(0),i=new TextDecoder;if(s===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,t,i)}_decodeUserBroadcast(e,t,s){let i=t.getUint8(1),n=t.getUint8(2),a=t.getUint8(3),o=t.getUint8(4),l=this.HEADER_LENGTH+4,h=s.decode(e.slice(l,l+i));l+=i;let u=s.decode(e.slice(l,l+n));l+=n;let c=s.decode(e.slice(l,l+a));l+=a;let d=e.slice(l,e.byteLength),p=o===this.JSON_ENCODING?JSON.parse(s.decode(d)):d,f={type:this.BROADCAST_EVENT,event:u,payload:p};return a>0&&(f.meta=JSON.parse(c)),{join_ref:null,ref:null,topic:h,event:this.BROADCAST_EVENT,payload:f}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e?.constructor)==null?void 0:t.name)==="ArrayBuffer"}_pick(e,t){return e&&typeof e=="object"?Object.fromEntries(Object.entries(e).filter(([s])=>t.includes(s))):{}}}class ne{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(m=x||(x={})).abstime="abstime",m.bool="bool",m.date="date",m.daterange="daterange",m.float4="float4",m.float8="float8",m.int2="int2",m.int4="int4",m.int4range="int4range",m.int8="int8",m.int8range="int8range",m.json="json",m.jsonb="jsonb",m.money="money",m.numeric="numeric",m.oid="oid",m.reltime="reltime",m.text="text",m.time="time",m.timestamp="timestamp",m.timestamptz="timestamptz",m.timetz="timetz",m.tsrange="tsrange",m.tstzrange="tstzrange";let Oe=(r,e,t={})=>{var s;let i=(s=t.skipTypes)!=null?s:[];return e?Object.keys(e).reduce((n,a)=>(n[a]=rt(a,r,e,i),n),{}):{}},rt=(r,e,t,s)=>{let i=e.find(o=>o.name===r),n=i?.type,a=t[r];return n&&!s.includes(n)?ze(n,a):Se(a)},ze=(r,e)=>{if(r.charAt(0)==="_")return Er(e,r.slice(1,r.length));switch(r){case x.bool:return gt(e);case x.float4:case x.float8:case x.int2:case x.int4:case x.int8:case x.numeric:case x.oid:return kr(e);case x.json:case x.jsonb:return Sr(e);case x.timestamp:return Tr(e);case x.abstime:case x.date:case x.daterange:case x.int4range:case x.int8range:case x.money:case x.reltime:case x.text:case x.time:case x.timestamptz:case x.timetz:case x.tsrange:case x.tstzrange:default:return Se(e)}},Se=r=>r,gt=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},kr=r=>{if(typeof r=="string"){let e=parseFloat(r);if(!Number.isNaN(e))return e}return r},Sr=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch{}return r},Er=(r,e)=>{if(typeof r!="string")return r;let t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let i,n=r.slice(1,t);try{i=JSON.parse("["+n+"]")}catch{i=n?n.split(","):[]}return i.map(a=>ze(e,a))}return r},Tr=r=>typeof r=="string"?r.replace(" ","T"):r,Dt=r=>{let e=new URL(r);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class mt{constructor(e,t,s={},i=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)==null?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}(P=N||(N={})).SYNC="sync",P.JOIN="join",P.LEAVE="leave";class Ge{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let s=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},i=>{let{onJoin:n,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ge.syncState(this.state,i,n,a),this.pendingDiffs.forEach(l=>{this.state=Ge.syncDiff(this.state,l,n,a)}),this.pendingDiffs=[],o()}),this.channel._on(s.diff,{},i=>{let{onJoin:n,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=Ge.syncDiff(this.state,i,n,a),o())}),this.onJoin((i,n,a)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:n,newPresences:a})}),this.onLeave((i,n,a)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:n,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,i){let n=this.cloneDeep(e),a=this.transformState(t),o={},l={};return this.map(n,(h,u)=>{a[h]||(l[h]=u)}),this.map(a,(h,u)=>{let c=n[h];if(c){let d=u.map(g=>g.presence_ref),p=c.map(g=>g.presence_ref),f=u.filter(g=>0>p.indexOf(g.presence_ref)),y=c.filter(g=>0>d.indexOf(g.presence_ref));f.length>0&&(o[h]=f),y.length>0&&(l[h]=y)}else o[h]=u}),this.syncDiff(n,{joins:o,leaves:l},s,i)}static syncDiff(e,t,s,i){let{joins:n,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(n,(o,l)=>{var h;let u=(h=e[o])!=null?h:[];if(e[o]=this.cloneDeep(l),u.length>0){let c=e[o].map(p=>p.presence_ref),d=u.filter(p=>0>c.indexOf(p.presence_ref));e[o].unshift(...d)}s(o,u,l)}),this.map(a,(o,l)=>{let h=e[o];if(!h)return;let u=l.map(c=>c.presence_ref);h=h.filter(c=>0>u.indexOf(c.presence_ref)),e[o]=h,i(o,h,l),h.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return Object.getOwnPropertyNames(e=this.cloneDeep(e)).reduce((t,s)=>{let i=e[s];return"metas"in i?t[s]=i.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):t[s]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(E=A||(A={})).ALL="*",E.INSERT="INSERT",E.UPDATE="UPDATE",E.DELETE="DELETE",(w=Z||(Z={})).BROADCAST="broadcast",w.PRESENCE="presence",w.POSTGRES_CHANGES="postgres_changes",w.SYSTEM="system",(R=J||(J={})).SUBSCRIBED="SUBSCRIBED",R.TIMED_OUT="TIMED_OUT",R.CLOSED="CLOSED",R.CHANNEL_ERROR="CHANNEL_ERROR";class De{constructor(e,t={config:{}},s){var i,n;if(this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=_.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new mt(this,j.join,this.params,this.timeout),this.rejoinTimer=new ne(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=_.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=_.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=_.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=_.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=_.errored,this.rejoinTimer.scheduleTimeout())}),this._on(j.reply,{},(a,o)=>{this._trigger(this._replyEventName(o),a)}),this.presence=new Ge(this),this.broadcastEndpointURL=Dt(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&((n=(i=this.params.config)==null?void 0:i.broadcast)==null?void 0:n.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var s,i,n;if(this.socket.isConnected()||this.socket.connect(),this.state==_.closed){let{config:{broadcast:a,presence:o,private:l}}=this.params,h=(i=(s=this.bindings.postgres_changes)==null?void 0:s.map(p=>p.filter))!=null?i:[],u=!!this.bindings[Z.PRESENCE]&&this.bindings[Z.PRESENCE].length>0||((n=this.params.config.presence)==null?void 0:n.enabled)===!0,c={},d={broadcast:a,presence:Object.assign(Object.assign({},o),{enabled:u}),postgres_changes:h,private:l};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this._onError(p=>e?.(J.CHANNEL_ERROR,p)),this._onClose(()=>e?.(J.CLOSED)),this.updateJoinPayload(Object.assign({config:d},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:p})=>{var f;if(this.socket._isManualToken()||this.socket.setAuth(),p===void 0){e?.(J.SUBSCRIBED);return}{let y=this.bindings.postgres_changes,g=(f=y?.length)!=null?f:0,O=[];for(let v=0;v<g;v++){let K=y[v],{filter:{event:b,schema:W,table:q,filter:se}}=K,Ee=p&&p[v];if(Ee&&Ee.event===b&&De.isFilterValueEqual(Ee.schema,W)&&De.isFilterValueEqual(Ee.table,q)&&De.isFilterValueEqual(Ee.filter,se))O.push(Object.assign(Object.assign({},K),{id:Ee.id}));else{this.unsubscribe(),this.state=_.errored,e?.(J.CHANNEL_ERROR,Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=O,e&&e(J.SUBSCRIBED);return}}).receive("error",p=>{this.state=_.errored,e?.(J.CHANNEL_ERROR,Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{e?.(J.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this.state===_.joined&&e===Z.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,s)}async httpSend(e,t,s={}){var i;if(t==null)return Promise.reject("Payload is required for httpSend()");let n={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(n.Authorization=`Bearer ${this.socket.accessTokenValue}`);let a={method:"POST",headers:n,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},o=await this._fetchWithTimeout(this.broadcastEndpointURL,a,(i=s.timeout)!=null?i:this.timeout);if(o.status===202)return{success:!0};let l=o.statusText;try{let h=await o.json();l=h.error||h.message||l}catch{}return Promise.reject(Error(l))}async send(e,t={}){var s,i;if(this._canPush()||e.type!=="broadcast")return new Promise(n=>{var a,o,l;let h=this._push(e.type,e,t.timeout||this.timeout);e.type!=="broadcast"||((l=(o=(a=this.params)==null?void 0:a.config)==null?void 0:o.broadcast)==null?void 0:l.ack)||n("ok"),h.receive("ok",()=>n("ok")),h.receive("error",()=>n("error")),h.receive("timeout",()=>n("timed out"))});{console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");let{event:n,payload:a}=e,o={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(o.Authorization=`Bearer ${this.socket.accessTokenValue}`);let l={method:"POST",headers:o,body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:a,private:this.private}]})};try{let h=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(s=t.timeout)!=null?s:this.timeout);return await((i=h.body)==null?void 0:i.cancel()),h.ok?"ok":"error"}catch(h){return h.name==="AbortError"?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=_.leaving;let t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(j.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(i=>{(s=new mt(this,j.leave,{},e)).receive("ok",()=>{t(),i("ok")}).receive("timeout",()=>{t(),i("timed out")}).receive("error",()=>{i("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=_.closed,this.bindings={}}async _fetchWithTimeout(e,t,s){let i=new AbortController,n=setTimeout(()=>i.abort(),s),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(n),a}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new mt(this,e,t,s);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){let t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var i,n;let a=e.toLocaleLowerCase(),{close:o,error:l,leave:h,join:u}=j;if(s&&[o,l,h,u].indexOf(a)>=0&&s!==this._joinRef())return;let c=this._onMessage(a,t,s);if(t&&!c)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(i=this.bindings.postgres_changes)==null||i.filter(d=>{var p,f,y;return((p=d.filter)==null?void 0:p.event)==="*"||((y=(f=d.filter)==null?void 0:f.event)==null?void 0:y.toLocaleLowerCase())===a}).map(d=>d.callback(c,s)):(n=this.bindings[a])==null||n.filter(d=>{var p,f,y,g,O,v,K,b;if(!["broadcast","presence","postgres_changes"].includes(a))return d.type.toLocaleLowerCase()===a;if("id"in d){let W=d.id,q=(p=d.filter)==null?void 0:p.event;return W&&((f=t.ids)==null?void 0:f.includes(W))&&(q==="*"||q?.toLocaleLowerCase()===((y=t.data)==null?void 0:y.type.toLocaleLowerCase()))&&(!((g=d.filter)!=null&&g.table)||d.filter.table===((O=t.data)==null?void 0:O.table))}{let W=(K=(v=d?.filter)==null?void 0:v.event)==null?void 0:K.toLocaleLowerCase();return W==="*"||W===((b=t?.event)==null?void 0:b.toLocaleLowerCase())}}).map(d=>{if(typeof c=="object"&&"ids"in c){let p=c.data,{schema:f,table:y,commit_timestamp:g,type:O,errors:v}=p;c=Object.assign(Object.assign({},{schema:f,table:y,commit_timestamp:g,eventType:O,new:{},old:{},errors:v}),this._getPayloadRecords(p))}d.callback(c,s)})}_isClosed(){return this.state===_.closed}_isJoined(){return this.state===_.joined}_isJoining(){return this.state===_.joining}_isLeaving(){return this.state===_.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){let i=e.toLocaleLowerCase(),n={type:i,filter:t,callback:s};return this.bindings[i]?this.bindings[i].push(n):this.bindings[i]=[n],this}_off(e,t){let s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(i=>{var n;return!(((n=i.type)==null?void 0:n.toLocaleLowerCase())===s&&De.isEqual(i.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let s in e)if(e[s]!==t[s])return!1;return!0}static isFilterValueEqual(e,t){return(e??void 0)===(t??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(j.close,{},e)}_onError(e){this._on(j.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=_.joining,this.joinPush.resend(e))}_getPayloadRecords(e){let t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Oe(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Oe(e.columns,e.old_record)),t}}let yt=()=>{},Or=[1e3,2e3,5e3,1e4],Rr=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Ar{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.transport=null,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=yt,this.ref=0,this.reconnectTimer=null,this.vsn=Q,this.logger=yt,this.conn=null,this.sendBuffer=[],this.serializer=new Y,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=i=>i?(...n)=>i(...n):(...n)=>fetch(...n),!((s=t?.params)!=null&&s.apikey))throw Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${B.websocket}`,this.httpEndpoint=Dt(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=z.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");let t=e.message;throw t.includes("Node.js")?Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){let s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){let t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){let e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case T.connecting:return S.Connecting;case T.open:return S.Open;case T.closing:return S.Closing;default:return S.Closed}}isConnected(){return this.connectionState()===S.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){let s=`realtime:${e}`,i=this.getChannels().find(n=>n.topic===s);if(i)return i;{let n=new De(`realtime:${e}`,t,this);return this.channels.push(n),n}}push(e){let{topic:t,event:s,payload:i,ref:n}=e,a=()=>{this.encode(e,o=>{var l;(l=this.conn)==null||l.send(o)})};this.log("push",`${t} ${s} (${n})`,i),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)==null||e.close(1e3,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)==null||t.scheduleTimeout()},100);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply"&&t.ref&&t.ref===this.pendingHeartbeatRef){let h=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error",h)}catch(u){this.log("error","error in heartbeat callback",u)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}let{topic:s,event:i,payload:n,ref:a}=t,o=a?`(${a})`:"",l=n.status||"";this.log("receive",`${l} ${s} ${i} ${o}`.trim(),n),this.channels.filter(h=>h._isMember(s)).forEach(h=>h._trigger(i,n,a)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)==null||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===T.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===T.open||this.conn.readyState===T.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(e=>{this.log("error","error waiting for auth on connect",e),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this._terminateWorker()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)==null||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(j.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;let s=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${s}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{let s=new Blob([Rr],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t,s=!1;if(e)t=e,s=!0;else if(this.accessToken)try{t=await this.accessToken()}catch(i){this.log("error","Error fetching access token from callback",i),t=this.accessTokenValue}else t=this.accessTokenValue;s?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(i=>{let n={access_token:t,version:"realtime-js/2.90.1"};t&&i.updateJoinPayload(n),i.joinedOnce&&i._isJoined()&&i._push(j.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(t=>{this.log("error",`Error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new ne(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},10)},this.reconnectAfterMs)}_initializeOptions(e){var t,s,i,n,a,o,l,h,u,c,d,p;switch(this.transport=(t=e?.transport)!=null?t:null,this.timeout=(s=e?.timeout)!=null?s:1e4,this.heartbeatIntervalMs=(i=e?.heartbeatIntervalMs)!=null?i:25e3,this.worker=(n=e?.worker)!=null&&n,this.accessToken=(a=e?.accessToken)!=null?a:null,this.heartbeatCallback=(o=e?.heartbeatCallback)!=null?o:yt,this.vsn=(l=e?.vsn)!=null?l:Q,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e?.reconnectAfterMs)!=null?h:f=>Or[f-1]||1e4,this.vsn){case Q:this.encode=(u=e?.encode)!=null?u:(f,y)=>y(JSON.stringify(f)),this.decode=(c=e?.decode)!=null?c:(f,y)=>y(JSON.parse(f));break;case"2.0.0":this.encode=(d=e?.encode)!=null?d:this.serializer.encode.bind(this.serializer),this.decode=(p=e?.decode)!=null?p:this.serializer.decode.bind(this.serializer);break;default:throw Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if("u">typeof window&&!window.Worker)throw Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}var He=class extends Error{constructor(r,e){super(r),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&e.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};async function jr(r){return r&&r.type!=="none"?r.type==="bearer"?{Authorization:`Bearer ${r.token}`}:r.type==="header"?{[r.name]:r.value}:r.type==="custom"?await r.getHeaders():{}:{}}function st(r){return r.join("")}var Ir=class{constructor(r,e=""){this.client=r,this.prefix=e}async listNamespaces(r){let e=r?{parent:st(r.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(t=>({namespace:t}))}async createNamespace(r,e){let t={namespace:r.namespace,properties:e?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:t})).data}async dropNamespace(r){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${st(r.namespace)}`})}async loadNamespaceMetadata(r){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${st(r.namespace)}`})).data.properties}}async namespaceExists(r){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${st(r.namespace)}`}),!0}catch(e){if(e instanceof He&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(r,e){try{return await this.createNamespace(r,e)}catch(t){if(t instanceof He&&t.status===409)return;throw t}}};function qe(r){return r.join("")}var $r=class{constructor(r,e="",t){this.client=r,this.prefix=e,this.accessDelegation=t}async listTables(r){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${qe(r.namespace)}/tables`})).data.identifiers}async createTable(r,e){let t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${qe(r.namespace)}/tables`,body:e,headers:t})).data.metadata}async updateTable(r,e){let t=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${qe(r.namespace)}/tables/${r.name}`,body:e});return{"metadata-location":t.data["metadata-location"],metadata:t.data.metadata}}async dropTable(r,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${qe(r.namespace)}/tables/${r.name}`,query:{purgeRequested:String(e?.purge??!1)}})}async loadTable(r){let e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${qe(r.namespace)}/tables/${r.name}`,headers:e})).data.metadata}async tableExists(r){let e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${qe(r.namespace)}/tables/${r.name}`,headers:e}),!0}catch(t){if(t instanceof He&&t.status===404)return!1;throw t}}async createTableIfNotExists(r,e){try{return await this.createTable(r,e)}catch(t){if(t instanceof He&&t.status===409)return await this.loadTable({namespace:r.namespace,name:e.name});throw t}}},Cr=class{constructor(r){let e="v1";r.catalogName&&(e+=`/${r.catalogName}`);let t=r.baseUrl.endsWith("/")?r.baseUrl:`${r.baseUrl}/`;this.client=function(s){let i=s.fetchImpl??F.fetch;return{async request({method:n,path:a,query:o,body:l,headers:h}){let u=function(g,O,v){let K=new URL(O,g);if(v)for(let[b,W]of Object.entries(v))W!==void 0&&K.searchParams.set(b,W);return K.toString()}(s.baseUrl,a,o),c=await jr(s.auth),d=await i(u,{method:n,headers:{...l?{"Content-Type":"application/json"}:{},...c,...h},body:l?JSON.stringify(l):void 0}),p=await d.text(),f=(d.headers.get("content-type")||"").includes("application/json"),y=f&&p?JSON.parse(p):p;if(!d.ok){let g=f?y:void 0,O=g?.error;throw new He(O?.message??`Request failed with status ${d.status}`,{status:d.status,icebergType:O?.type,icebergCode:O?.code,details:g})}return{status:d.status,headers:d.headers,data:y}}}}({baseUrl:t,auth:r.auth,fetchImpl:r.fetch}),this.accessDelegation=r.accessDelegation?.join(","),this.namespaceOps=new Ir(this.client,e),this.tableOps=new $r(this.client,e,this.accessDelegation)}async listNamespaces(r){return this.namespaceOps.listNamespaces(r)}async createNamespace(r,e){return this.namespaceOps.createNamespace(r,e)}async dropNamespace(r){await this.namespaceOps.dropNamespace(r)}async loadNamespaceMetadata(r){return this.namespaceOps.loadNamespaceMetadata(r)}async listTables(r){return this.tableOps.listTables(r)}async createTable(r,e){return this.tableOps.createTable(r,e)}async updateTable(r,e){return this.tableOps.updateTable(r,e)}async dropTable(r,e){await this.tableOps.dropTable(r,e)}async loadTable(r){return this.tableOps.loadTable(r)}async namespaceExists(r){return this.namespaceOps.namespaceExists(r)}async tableExists(r){return this.tableOps.tableExists(r)}async createNamespaceIfNotExists(r,e){return this.namespaceOps.createNamespaceIfNotExists(r,e)}async createTableIfNotExists(r,e){return this.tableOps.createTableIfNotExists(r,e)}},qt=U(5356).Buffer,it=class extends Error{constructor(r){super(r),this.__isStorageError=!0,this.name="StorageError"}};function ee(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}var Pr=class extends it{constructor(r,e,t){super(r),this.name="StorageApiError",this.status=e,this.statusCode=t}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},wt=class extends it{constructor(r,e){super(r),this.name="StorageUnknownError",this.originalError=e}};let bt=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),_t=r=>{if(Array.isArray(r))return r.map(t=>_t(t));if(typeof r=="function"||r!==Object(r))return r;let e={};return Object.entries(r).forEach(([t,s])=>{e[t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""))]=_t(s)}),e};function nt(r){return(nt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(r)}function Lt(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,s)}return t}function $(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Lt(Object(t),!0).forEach(function(s){(function(i,n,a){var o;o=function(l,h){if(nt(l)!="object"||!l)return l;var u=l[Symbol.toPrimitive];if(u!==void 0){var c=u.call(l,h||"default");if(nt(c)!="object")return c;throw TypeError("@@toPrimitive must return a primitive value.")}return(h==="string"?String:Number)(l)}(n,"string"),(n=nt(o)=="symbol"?o:o+"")in i?Object.defineProperty(i,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[n]=a})(r,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Lt(Object(t)).forEach(function(s){Object.defineProperty(r,s,Object.getOwnPropertyDescriptor(t,s))})}return r}let vt=r=>{var e;return r.msg||r.message||r.error_description||(typeof r.error=="string"?r.error:(e=r.error)==null?void 0:e.message)||JSON.stringify(r)},xr=async(r,e,t)=>{r instanceof await Response&&!t?.noResolveJson?r.json().then(s=>{let i=r.status||500,n=s?.statusCode||i+"";e(new Pr(vt(s),i,n))}).catch(s=>{e(new wt(vt(s),s))}):e(new wt(vt(r),r))};async function Ye(r,e,t,s,i,n){return new Promise((a,o)=>{let l;r(t,(l={method:e,headers:s?.headers||{}},e==="GET"||!n?l:((h=>{if(typeof h!="object"||h===null)return!1;let u=Object.getPrototypeOf(h);return(u===null||u===Object.prototype||Object.getPrototypeOf(u)===null)&&!(Symbol.toStringTag in h)&&!(Symbol.iterator in h)})(n)?(l.headers=$({"Content-Type":"application/json"},s?.headers),l.body=JSON.stringify(n)):l.body=n,s?.duplex&&(l.duplex=s.duplex),$($({},l),i)))).then(h=>{if(!h.ok)throw h;return s?.noResolveJson?h:h.json()}).then(h=>a(h)).catch(h=>xr(h,o,s))})}async function Xe(r,e,t,s){return Ye(r,"GET",e,t,s)}async function Re(r,e,t,s,i){return Ye(r,"POST",e,s,i,t)}async function kt(r,e,t,s,i){return Ye(r,"PUT",e,s,i,t)}async function Nr(r,e,t,s){return Ye(r,"HEAD",e,$($({},t),{},{noResolveJson:!0}),s)}async function St(r,e,t,s,i){return Ye(r,"DELETE",e,s,i,t)}var Ur=class{constructor(r,e){this.downloadFn=r,this.shouldThrowOnError=e}then(r,e){return this.execute().then(r,e)}async execute(){try{return{data:(await this.downloadFn()).body,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ee(r))return{data:null,error:r};throw r}}};oe=Symbol.toStringTag;var Dr=class{constructor(r,e){this.downloadFn=r,this.shouldThrowOnError=e,this[oe]="BlobDownloadBuilder",this.promise=null}asStream(){return new Ur(this.downloadFn,this.shouldThrowOnError)}then(r,e){return this.getPromise().then(r,e)}catch(r){return this.getPromise().catch(r)}finally(r){return this.getPromise().finally(r)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){try{return{data:await(await this.downloadFn()).blob(),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ee(r))return{data:null,error:r};throw r}}};let qr={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Bt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var Lr=class{constructor(r,e={},t,s){this.shouldThrowOnError=!1,this.url=r,this.headers=e,this.bucketId=t,this.fetch=bt(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(r,e,t,s){try{let i,n=$($({},Bt),s),a=$($({},this.headers),r==="POST"&&{"x-upsert":String(n.upsert)}),o=n.metadata;"u">typeof Blob&&t instanceof Blob?((i=new FormData).append("cacheControl",n.cacheControl),o&&i.append("metadata",this.encodeMetadata(o)),i.append("",t)):"u">typeof FormData&&t instanceof FormData?((i=t).has("cacheControl")||i.append("cacheControl",n.cacheControl),o&&!i.has("metadata")&&i.append("metadata",this.encodeMetadata(o))):(i=t,a["cache-control"]=`max-age=${n.cacheControl}`,a["content-type"]=n.contentType,o&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(o))),("u">typeof ReadableStream&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!n.duplex&&(n.duplex="half")),s?.headers&&(a=$($({},a),s.headers));let l=this._removeEmptyFolders(e),h=this._getFinalPath(l),u=await(r=="PUT"?kt:Re)(this.fetch,`${this.url}/object/${h}`,i,$({headers:a},n?.duplex?{duplex:n.duplex}:{}));return{data:{path:l,id:u.Id,fullPath:u.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(ee(i))return{data:null,error:i};throw i}}async upload(r,e,t){return this.uploadOrUpdate("POST",r,e,t)}async uploadToSignedUrl(r,e,t,s){let i=this._removeEmptyFolders(r),n=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${n}`);a.searchParams.set("token",e);try{let o,l=$({upsert:Bt.upsert},s),h=$($({},this.headers),{"x-upsert":String(l.upsert)});return"u">typeof Blob&&t instanceof Blob?((o=new FormData).append("cacheControl",l.cacheControl),o.append("",t)):"u">typeof FormData&&t instanceof FormData?(o=t).append("cacheControl",l.cacheControl):(o=t,h["cache-control"]=`max-age=${l.cacheControl}`,h["content-type"]=l.contentType),{data:{path:i,fullPath:(await kt(this.fetch,a.toString(),o,{headers:h})).Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(ee(o))return{data:null,error:o};throw o}}async createSignedUploadUrl(r,e){try{let t=this._getFinalPath(r),s=$({},this.headers);e?.upsert&&(s["x-upsert"]="true");let i=await Re(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:s}),n=new URL(this.url+i.url),a=n.searchParams.get("token");if(!a)throw new it("No token returned by API");return{data:{signedUrl:n.toString(),path:r,token:a},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ee(t))return{data:null,error:t};throw t}}async update(r,e,t){return this.uploadOrUpdate("PUT",r,e,t)}async move(r,e,t){try{return{data:await Re(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:r,destinationKey:e,destinationBucket:t?.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ee(s))return{data:null,error:s};throw s}}async copy(r,e,t){try{return{data:{path:(await Re(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:r,destinationKey:e,destinationBucket:t?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ee(s))return{data:null,error:s};throw s}}async createSignedUrl(r,e,t){try{let s=this._getFinalPath(r),i=await Re(this.fetch,`${this.url}/object/sign/${s}`,$({expiresIn:e},t?.transform?{transform:t.transform}:{}),{headers:this.headers}),n=t?.download?`&download=${t.download===!0?"":t.download}`:"";return{data:i={signedUrl:encodeURI(`${this.url}${i.signedURL}${n}`)},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ee(s))return{data:null,error:s};throw s}}async createSignedUrls(r,e,t){var s=this;try{let i=await Re(s.fetch,`${s.url}/object/sign/${s.bucketId}`,{expiresIn:e,paths:r},{headers:s.headers}),n=t?.download?`&download=${t.download===!0?"":t.download}`:"";return{data:i.map(a=>$($({},a),{},{signedUrl:a.signedURL?encodeURI(`${s.url}${a.signedURL}${n}`):null})),error:null}}catch(i){if(s.shouldThrowOnError)throw i;if(ee(i))return{data:null,error:i};throw i}}download(r,e){let t=e?.transform!==void 0?"render/image/authenticated":"object",s=this.transformOptsToQueryString(e?.transform||{}),i=s?`?${s}`:"",n=this._getFinalPath(r);return new Dr(()=>Xe(this.fetch,`${this.url}/${t}/${n}${i}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}async info(r){let e=this._getFinalPath(r);try{return{data:_t(await Xe(this.fetch,`${this.url}/object/info/${e}`,{headers:this.headers})),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ee(t))return{data:null,error:t};throw t}}async exists(r){let e=this._getFinalPath(r);try{return await Nr(this.fetch,`${this.url}/object/${e}`,{headers:this.headers}),{data:!0,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ee(t)&&t instanceof wt){let s=t.originalError;if([400,404].includes(s?.status))return{data:!1,error:t}}throw t}}getPublicUrl(r,e){let t=this._getFinalPath(r),s=[],i=e?.download?`download=${e.download===!0?"":e.download}`:"";i!==""&&s.push(i);let n=e?.transform!==void 0?"render/image":"object",a=this.transformOptsToQueryString(e?.transform||{});a!==""&&s.push(a);let o=s.join("&");return o!==""&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${n}/public/${t}${o}`)}}}async remove(r){try{return{data:await St(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:r},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ee(e))return{data:null,error:e};throw e}}async list(r,e,t){try{let s=$($($({},qr),e),{},{prefix:r||""});return{data:await Re(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},t),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ee(s))return{data:null,error:s};throw s}}async listV2(r,e){try{let t=$({},r);return{data:await Re(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,t,{headers:this.headers},e),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ee(t))return{data:null,error:t};throw t}}encodeMetadata(r){return JSON.stringify(r)}toBase64(r){return qt!==void 0?qt.from(r).toString("base64"):btoa(r)}_getFinalPath(r){return`${this.bucketId}/${r.replace(/^\/+/,"")}`}_removeEmptyFolders(r){return r.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(r){let e=[];return r.width&&e.push(`width=${r.width}`),r.height&&e.push(`height=${r.height}`),r.resize&&e.push(`resize=${r.resize}`),r.format&&e.push(`format=${r.format}`),r.quality&&e.push(`quality=${r.quality}`),e.join("&")}};let Kt="2.90.1",Wt={"X-Client-Info":`storage-js/${Kt}`};var Br=class{constructor(r,e={},t,s){this.shouldThrowOnError=!1;let i=new URL(r);s?.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href.replace(/\/$/,""),this.headers=$($({},Wt),e),this.fetch=bt(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(r){try{let e=this.listBucketOptionsToQueryString(r);return{data:await Xe(this.fetch,`${this.url}/bucket${e}`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ee(e))return{data:null,error:e};throw e}}async getBucket(r){try{return{data:await Xe(this.fetch,`${this.url}/bucket/${r}`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ee(e))return{data:null,error:e};throw e}}async createBucket(r,e={public:!1}){try{return{data:await Re(this.fetch,`${this.url}/bucket`,{id:r,name:r,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ee(t))return{data:null,error:t};throw t}}async updateBucket(r,e){try{return{data:await kt(this.fetch,`${this.url}/bucket/${r}`,{id:r,name:r,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ee(t))return{data:null,error:t};throw t}}async emptyBucket(r){try{return{data:await Re(this.fetch,`${this.url}/bucket/${r}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ee(e))return{data:null,error:e};throw e}}async deleteBucket(r){try{return{data:await St(this.fetch,`${this.url}/bucket/${r}`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ee(e))return{data:null,error:e};throw e}}listBucketOptionsToQueryString(r){let e={};return r&&("limit"in r&&(e.limit=String(r.limit)),"offset"in r&&(e.offset=String(r.offset)),r.search&&(e.search=r.search),r.sortColumn&&(e.sortColumn=r.sortColumn),r.sortOrder&&(e.sortOrder=r.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},Kr=class{constructor(r,e={},t){this.shouldThrowOnError=!1,this.url=r.replace(/\/$/,""),this.headers=$($({},Wt),e),this.fetch=bt(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(r){try{return{data:await Re(this.fetch,`${this.url}/bucket`,{name:r},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ee(e))return{data:null,error:e};throw e}}async listBuckets(r){try{let e=new URLSearchParams;r?.limit!==void 0&&e.set("limit",r.limit.toString()),r?.offset!==void 0&&e.set("offset",r.offset.toString()),r?.sortColumn&&e.set("sortColumn",r.sortColumn),r?.sortOrder&&e.set("sortOrder",r.sortOrder),r?.search&&e.set("search",r.search);let t=e.toString(),s=t?`${this.url}/bucket?${t}`:`${this.url}/bucket`;return{data:await Xe(this.fetch,s,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ee(e))return{data:null,error:e};throw e}}async deleteBucket(r){try{return{data:await St(this.fetch,`${this.url}/bucket/${r}`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ee(e))return{data:null,error:e};throw e}}from(r){var e=this;if(!(!(!r||typeof r!="string"||r.length===0||r.length>100||r.trim()!==r||r.includes("/")||r.includes("\\"))&&/^[\w!.\*'() &$@=;:+,?-]+$/.test(r)))throw new it("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");let t=new Cr({baseUrl:this.url,catalogName:r,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),s=this.shouldThrowOnError;return new Proxy(t,{get(i,n){let a=i[n];return typeof a!="function"?a:async(...o)=>{try{return{data:await a.apply(i,o),error:null}}catch(l){if(s)throw l;return{data:null,error:l}}}}})}};let Et={"X-Client-Info":`storage-js/${Kt}`,"Content-Type":"application/json"};var Mt=class extends Error{constructor(r){super(r),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function _e(r){return typeof r=="object"&&r!==null&&"__isStorageVectorsError"in r}var Tt=class extends Mt{constructor(r,e,t){super(r),this.name="StorageVectorsApiError",this.status=e,this.statusCode=t}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Wr=class extends Mt{constructor(r,e){super(r),this.name="StorageVectorsUnknownError",this.originalError=e}};let Ot=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),Jt=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Mr=async(r,e,t)=>{if(r&&typeof r=="object"&&"status"in r&&"ok"in r&&typeof r.status=="number"&&!t?.noResolveJson){let s=r.status||500;typeof r.json=="function"?r.json().then(i=>{let n=i?.statusCode||i?.code||s+"";e(new Tt(Jt(i),s,n))}).catch(()=>{e(new Tt(r.statusText||`HTTP ${s} error`,s,s+""))}):e(new Tt(r.statusText||`HTTP ${s} error`,s,s+""))}else e(new Wr(Jt(r),r))};async function Jr(r,e,t,s,i,n){return new Promise((a,o)=>{let l;r(t,(l={method:e,headers:s?.headers||{}},e==="GET"||!n?l:((h=>{if(typeof h!="object"||h===null)return!1;let u=Object.getPrototypeOf(h);return(u===null||u===Object.prototype||Object.getPrototypeOf(u)===null)&&!(Symbol.toStringTag in h)&&!(Symbol.iterator in h)})(n)?(l.headers=$({"Content-Type":"application/json"},s?.headers),l.body=JSON.stringify(n)):l.body=n,$($({},l),i)))).then(h=>{if(!h.ok)throw h;if(s?.noResolveJson)return h;let u=h.headers.get("content-type");return u&&u.includes("application/json")?h.json():{}}).then(h=>a(h)).catch(h=>Mr(h,o,s))})}async function ve(r,e,t,s,i){return Jr(r,"POST",e,s,i,t)}var Fr=class{constructor(r,e={},t){this.shouldThrowOnError=!1,this.url=r.replace(/\/$/,""),this.headers=$($({},Et),e),this.fetch=Ot(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(r){try{return{data:await ve(this.fetch,`${this.url}/CreateIndex`,r,{headers:this.headers})||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(_e(e))return{data:null,error:e};throw e}}async getIndex(r,e){try{return{data:await ve(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:r,indexName:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(_e(t))return{data:null,error:t};throw t}}async listIndexes(r){try{return{data:await ve(this.fetch,`${this.url}/ListIndexes`,r,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(_e(e))return{data:null,error:e};throw e}}async deleteIndex(r,e){try{return{data:await ve(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:r,indexName:e},{headers:this.headers})||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(_e(t))return{data:null,error:t};throw t}}},Vr=class{constructor(r,e={},t){this.shouldThrowOnError=!1,this.url=r.replace(/\/$/,""),this.headers=$($({},Et),e),this.fetch=Ot(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(r){try{if(r.vectors.length<1||r.vectors.length>500)throw Error("Vector batch size must be between 1 and 500 items");return{data:await ve(this.fetch,`${this.url}/PutVectors`,r,{headers:this.headers})||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(_e(e))return{data:null,error:e};throw e}}async getVectors(r){try{return{data:await ve(this.fetch,`${this.url}/GetVectors`,r,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(_e(e))return{data:null,error:e};throw e}}async listVectors(r){try{if(r.segmentCount!==void 0){if(r.segmentCount<1||r.segmentCount>16)throw Error("segmentCount must be between 1 and 16");if(r.segmentIndex!==void 0&&(r.segmentIndex<0||r.segmentIndex>=r.segmentCount))throw Error(`segmentIndex must be between 0 and ${r.segmentCount-1}`)}return{data:await ve(this.fetch,`${this.url}/ListVectors`,r,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(_e(e))return{data:null,error:e};throw e}}async queryVectors(r){try{return{data:await ve(this.fetch,`${this.url}/QueryVectors`,r,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(_e(e))return{data:null,error:e};throw e}}async deleteVectors(r){try{if(r.keys.length<1||r.keys.length>500)throw Error("Keys batch size must be between 1 and 500 items");return{data:await ve(this.fetch,`${this.url}/DeleteVectors`,r,{headers:this.headers})||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(_e(e))return{data:null,error:e};throw e}}},zr=class{constructor(r,e={},t){this.shouldThrowOnError=!1,this.url=r.replace(/\/$/,""),this.headers=$($({},Et),e),this.fetch=Ot(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(r){try{return{data:await ve(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:r},{headers:this.headers})||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(_e(e))return{data:null,error:e};throw e}}async getBucket(r){try{return{data:await ve(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:r},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(_e(e))return{data:null,error:e};throw e}}async listBuckets(r={}){try{return{data:await ve(this.fetch,`${this.url}/ListVectorBuckets`,r,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(_e(e))return{data:null,error:e};throw e}}async deleteBucket(r){try{return{data:await ve(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:r},{headers:this.headers})||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(_e(e))return{data:null,error:e};throw e}}},Gr=class extends zr{constructor(r,e={}){super(r,e.headers||{},e.fetch)}from(r){return new Hr(this.url,this.headers,r,this.fetch)}async createBucket(r){return super.createBucket.call(this,r)}async getBucket(r){return super.getBucket.call(this,r)}async listBuckets(r={}){return super.listBuckets.call(this,r)}async deleteBucket(r){return super.deleteBucket.call(this,r)}},Hr=class extends Fr{constructor(r,e,t,s){super(r,e,s),this.vectorBucketName=t}async createIndex(r){return super.createIndex.call(this,$($({},r),{},{vectorBucketName:this.vectorBucketName}))}async listIndexes(r={}){return super.listIndexes.call(this,$($({},r),{},{vectorBucketName:this.vectorBucketName}))}async getIndex(r){return super.getIndex.call(this,this.vectorBucketName,r)}async deleteIndex(r){return super.deleteIndex.call(this,this.vectorBucketName,r)}index(r){return new Yr(this.url,this.headers,this.vectorBucketName,r,this.fetch)}},Yr=class extends Vr{constructor(r,e,t,s,i){super(r,e,i),this.vectorBucketName=t,this.indexName=s}async putVectors(r){return super.putVectors.call(this,$($({},r),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}async getVectors(r){return super.getVectors.call(this,$($({},r),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}async listVectors(r={}){return super.listVectors.call(this,$($({},r),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}async queryVectors(r){return super.queryVectors.call(this,$($({},r),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}async deleteVectors(r){return super.deleteVectors.call(this,$($({},r),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}},Xr=class extends Br{constructor(r,e={},t,s){super(r,e,t,s)}from(r){return new Lr(this.url,this.headers,r,this.fetch)}get vectors(){return new Gr(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Kr(this.url+"/iceberg",this.headers,this.fetch)}};let Ft="2.90.1",Zr={"X-Client-Info":`gotrue-js/${Ft}`},Rt="X-Supabase-Api-Version",Vt={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Qr=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class Ze extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function k(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class es extends Ze{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}class $e extends Ze{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class je extends Ze{constructor(e,t,s,i){super(e,s,i),this.name=t,this.status=s}}class ke extends je{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Le extends je{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class at extends je{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ot extends je{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class zt extends je{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ts extends je{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class At extends je{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function jt(r){return k(r)&&r.name==="AuthRetryableFetchError"}class Gt extends je{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class It extends je{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}let lt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ht=` 	
\r=`.split(""),rs=(()=>{let r=Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<Ht.length;e+=1)r[Ht[e].charCodeAt(0)]=-2;for(let e=0;e<lt.length;e+=1)r[lt[e].charCodeAt(0)]=e;return r})();function Yt(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;)t(lt[e.queue>>e.queuedBits-6&63]),e.queuedBits-=6;else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;)t(lt[e.queue>>e.queuedBits-6&63]),e.queuedBits-=6}function Xt(r,e,t){let s=rs[r];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function Zt(r){let e=[],t=a=>{e.push(String.fromCodePoint(a))},s={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},n=a=>{(function(o,l,h){if(l.utf8seq===0){if(o<=127)return h(o);for(let u=1;u<6;u+=1)if((o>>7-u&1)==0){l.utf8seq=u;break}if(l.utf8seq===2)l.codepoint=31&o;else if(l.utf8seq===3)l.codepoint=15&o;else if(l.utf8seq===4)l.codepoint=7&o;else throw Error("Invalid UTF-8 sequence");l.utf8seq-=1}else if(l.utf8seq>0){if(o<=127)throw Error("Invalid UTF-8 sequence");l.codepoint=l.codepoint<<6|63&o,l.utf8seq-=1,l.utf8seq===0&&h(l.codepoint)}})(a,s,t)};for(let a=0;a<r.length;a+=1)Xt(r.charCodeAt(a),i,n);return e.join("")}function Be(r){let e=[],t={queue:0,queuedBits:0},s=i=>{e.push(i)};for(let i=0;i<r.length;i+=1)Xt(r.charCodeAt(i),t,s);return new Uint8Array(e)}function Ce(r){let e=[],t={queue:0,queuedBits:0},s=i=>{e.push(i)};return r.forEach(i=>Yt(i,t,s)),Yt(null,t,s),e.join("")}let ce=()=>"u">typeof window&&"u">typeof document,Pe={tested:!1,writable:!1},Qt=()=>{if(!ce())return!1;try{if(typeof F.localStorage!="object")return!1}catch{return!1}if(Pe.tested)return Pe.writable;let r=`lswt-${Math.random()}${Math.random()}`;try{F.localStorage.setItem(r,r),F.localStorage.removeItem(r),Pe.tested=!0,Pe.writable=!0}catch{Pe.tested=!0,Pe.writable=!1}return Pe.writable},er=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),Ke=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},xe=async(r,e)=>{let t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},de=async(r,e)=>{await r.removeItem(e)};class ht{constructor(){this.promise=new ht.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function $t(r){let e=r.split(".");if(e.length!==3)throw new It("Invalid JWT structure");for(let t=0;t<e.length;t++)if(!Qr.test(e[t]))throw new It("JWT not in base64url format");return{header:JSON.parse(Zt(e[0])),payload:JSON.parse(Zt(e[1])),signature:Be(e[2]),raw:{header:e[0],payload:e[1]}}}async function ss(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function is(r){return("0"+r.toString(16)).substr(-2)}async function ns(r){let e=new TextEncoder().encode(r);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",e))).map(t=>String.fromCharCode(t)).join("")}async function as(r){return"u">typeof crypto&&crypto.subtle!==void 0&&"u">typeof TextEncoder?btoa(await ns(r)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""):(console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r)}async function We(r,e,t=!1){let s=function(){let o=new Uint32Array(56);if("u"<typeof crypto){let l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",h=l.length,u="";for(let c=0;c<56;c++)u+=l.charAt(Math.floor(Math.random()*h));return u}return crypto.getRandomValues(o),Array.from(o,is).join("")}(),i=s;t&&(i+="/PASSWORD_RECOVERY"),await Ke(r,`${e}-code-verifier`,i);let n=await as(s);return[n,s===n?"plain":"s256"]}ht.promiseConstructor=Promise;let os=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,ls=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Me(r){if(!ls.test(r))throw Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Ct(){return new Proxy({},{get:(r,e)=>{if(e==="__isUserNotAvailableProxy")return!0;if(typeof e=="symbol"){let t=e.toString();if(t==="Symbol(Symbol.toPrimitive)"||t==="Symbol(Symbol.toStringTag)"||t==="Symbol(util.inspect.custom)")return}throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${e}" property of the session object is not supported. Please use getUser() instead.`)},set:(r,e)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(r,e)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function tr(r){return JSON.parse(JSON.stringify(r))}let Ne=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),hs=[502,503,504];async function rr(r){var e;let t,s;if(!(typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function"))throw new At(Ne(r),0);if(hs.includes(r.status))throw new At(Ne(r),r.status);try{t=await r.json()}catch(n){throw new $e(Ne(n),n)}let i=function(n){let a=n.headers.get(Rt);if(!a||!a.match(os))return null;try{return new Date(`${a}T00:00:00.0Z`)}catch{return null}}(r);if(i&&i.getTime()>=Vt["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new Gt(Ne(t),r.status,((e=t.weak_password)==null?void 0:e.reasons)||[]);if(s==="session_not_found")throw new ke}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((n,a)=>n&&typeof a=="string",!0))throw new Gt(Ne(t),r.status,t.weak_password.reasons);throw new es(Ne(t),r.status||500,s)}async function C(r,e,t,s){var i;let n=Object.assign({},s?.headers);n[Rt]||(n[Rt]=Vt["2024-01-01"].name),s?.jwt&&(n.Authorization=`Bearer ${s.jwt}`);let a=(i=s?.query)!=null?i:{};s?.redirectTo&&(a.redirect_to=s.redirectTo);let o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await us(r,e,t+o,{headers:n,noResolveJson:s?.noResolveJson},{},s?.body);return s?.xform?s?.xform(l):{data:Object.assign({},l),error:null}}async function us(r,e,t,s,i,n){let a,o,l=(o={method:e,headers:s?.headers||{}},e==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},s?.headers),o.body=JSON.stringify(n),Object.assign(Object.assign({},o),i)));try{a=await r(t,Object.assign({},l))}catch(h){throw console.error(h),new At(Ne(h),0)}if(a.ok||await rr(a),s?.noResolveJson)return a;try{return await a.json()}catch(h){await rr(h)}}function Ae(r){var e,t,s;let i=null;return(s=r).access_token&&s.refresh_token&&s.expires_in&&(i=Object.assign({},r),r.expires_at||(i.expires_at=(t=r.expires_in,Math.round(Date.now()/1e3)+t))),{data:{session:i,user:(e=r.user)!=null?e:r},error:null}}function sr(r){let e=Ae(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function Ie(r){var e;return{data:{user:(e=r.user)!=null?e:r},error:null}}function cs(r){return{data:r,error:null}}function ds(r){let{action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:n}=r;return{data:{properties:{action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:n},user:Object.assign({},le(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]))},error:null}}function ir(r){return r}let Pt=["global","local","others"];class fs{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=er(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=Pt[0]){if(0>Pt.indexOf(t))throw Error(`@supabase/auth-js: Parameter scope must be one of ${Pt.join(", ")}`);try{return await C(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(k(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await C(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Ie})}catch(s){if(k(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{let{options:t}=e,s=le(e,["options"]),i=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(i.new_email=s?.newEmail,delete i.newEmail),await C(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:ds,redirectTo:t?.redirectTo})}catch(t){if(k(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await C(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ie})}catch(t){if(k(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,i,n,a,o,l;try{let h={nextPage:null,lastPage:0,total:0},u=await C(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e?.page)==null?void 0:t.toString())!=null?s:"",per_page:(n=(i=e?.perPage)==null?void 0:i.toString())!=null?n:""},xform:ir});if(u.error)throw u.error;let c=await u.json(),d=(a=u.headers.get("x-total-count"))!=null?a:0,p=(l=(o=u.headers.get("link"))==null?void 0:o.split(","))!=null?l:[];return p.length>0&&(p.forEach(f=>{let y=parseInt(f.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(f.split(";")[1].split("=")[1]);h[`${g}Page`]=y}),h.total=parseInt(d)),{data:Object.assign(Object.assign({},c),h),error:null}}catch(h){if(k(h))return{data:{users:[]},error:h};throw h}}async getUserById(e){Me(e);try{return await C(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ie})}catch(t){if(k(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Me(e);try{return await C(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Ie})}catch(s){if(k(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){Me(e);try{return await C(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Ie})}catch(s){if(k(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){Me(e.userId);try{let{data:t,error:s}=await C(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:s}}catch(t){if(k(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Me(e.userId),Me(e.id);try{return{data:await C(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(k(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,s,i,n,a,o,l;try{let h={nextPage:null,lastPage:0,total:0},u=await C(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e?.page)==null?void 0:t.toString())!=null?s:"",per_page:(n=(i=e?.perPage)==null?void 0:i.toString())!=null?n:""},xform:ir});if(u.error)throw u.error;let c=await u.json(),d=(a=u.headers.get("x-total-count"))!=null?a:0,p=(l=(o=u.headers.get("link"))==null?void 0:o.split(","))!=null?l:[];return p.length>0&&(p.forEach(f=>{let y=parseInt(f.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(f.split(";")[1].split("=")[1]);h[`${g}Page`]=y}),h.total=parseInt(d)),{data:Object.assign(Object.assign({},c),h),error:null}}catch(h){if(k(h))return{data:{clients:[]},error:h};throw h}}async _createOAuthClient(e){try{return await C(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(k(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await C(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(k(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await C(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(k(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(e){try{return await C(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(k(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await C(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(k(t))return{data:null,error:t};throw t}}}function nr(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}let Je={debug:!!(F&&Qt()&&F.localStorage&&F.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class ar extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class ps extends ar{}async function gs(r,e,t){Je.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);let s=new F.AbortController;return e>0&&setTimeout(()=>{s.abort(),Je.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>F.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async i=>{if(i){Je.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,i.name);try{return await t()}finally{Je.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,i.name)}}if(e===0)throw Je.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new ps(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(Je.debug)try{let n=await F.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}))}function or(r){if(!/^0x[a-fA-F0-9]{40}$/.test(r))throw Error(`@supabase/auth-js: Address "${r}" is invalid.`);return r.toLowerCase()}class ae extends Error{constructor({message:e,code:t,cause:s,name:i}){var n;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=(n=i??(s instanceof Error?s.name:void 0))!=null?n:"Unknown Error",this.code=t}}class ut extends ae{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}class ms{createNewAbortSignal(){if(this.controller){let t=Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}let e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){let e=Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}let ys=new ms;function lr(r){return r==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(r)}function hr(){var r,e;return!!(ce()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((r=navigator?.credentials)==null?void 0:r.create)=="function"&&typeof((e=navigator?.credentials)==null?void 0:e.get)=="function")}async function ws(r){try{let e=await navigator.credentials.create(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new ut("Browser returned unexpected credential type",e)}:{data:null,error:new ut("Empty credential response",e)}}catch(e){return{data:null,error:function({error:t,options:s}){var i,n,a;let{publicKey:o}=s;if(!o)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(s.signal instanceof AbortSignal)return new ae({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((i=o.authenticatorSelection)==null?void 0:i.requireResidentKey)===!0)return new ae({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(s.mediation==="conditional"&&((n=o.authenticatorSelection)==null?void 0:n.userVerification)==="required")return new ae({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((a=o.authenticatorSelection)==null?void 0:a.userVerification)==="required")return new ae({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new ae({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new ae({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return new ae(o.pubKeyCredParams.filter(l=>l.type==="public-key").length===0?{message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}:{message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){let l=window.location.hostname;if(!lr(l))return new ae({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t});if(o.rp.id!==l)return new ae({message:`The RP ID "${o.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else if(t.name==="TypeError"){if(o.user.id.byteLength<1||o.user.id.byteLength>64)return new ae({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new ae({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new ae({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}({error:e,options:r})}}}async function bs(r){try{let e=await navigator.credentials.get(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new ut("Browser returned unexpected credential type",e)}:{data:null,error:new ut("Empty credential response",e)}}catch(e){return{data:null,error:function({error:t,options:s}){let{publicKey:i}=s;if(!i)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(s.signal instanceof AbortSignal)return new ae({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new ae({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){let n=window.location.hostname;if(!lr(n))return new ae({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t});if(i.rpId!==n)return new ae({message:`The RP ID "${i.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else if(t.name==="UnknownError")return new ae({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new ae({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}({error:e,options:r})}}}let _s={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},vs={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function ct(...r){let e=i=>i!==null&&typeof i=="object"&&!Array.isArray(i),t=i=>i instanceof ArrayBuffer||ArrayBuffer.isView(i),s={};for(let i of r)if(i)for(let n in i){let a=i[n];if(a!==void 0)if(Array.isArray(a))s[n]=a;else if(t(a))s[n]=a;else if(e(a)){let o=s[n];e(o)?s[n]=ct(o,a):s[n]=ct(a)}else s[n]=a}return s}class ks{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:s,signal:i},n){try{var a,o,l,h;let{data:u,error:c}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!u)return{data:null,error:c};let d=i??ys.createNewAbortSignal();if(u.webauthn.type==="create"){let{user:p}=u.webauthn.credential_options.publicKey;p.name||(p.name=`${p.id}:${s}`),p.displayName||(p.displayName=p.name)}switch(u.webauthn.type){case"create":{let p=(a=u.webauthn.credential_options.publicKey,o=n?.create,ct(_s,a,o||{})),{data:f,error:y}=await ws({publicKey:p,signal:d});return f?{data:{factorId:e,challengeId:u.id,webauthn:{type:u.webauthn.type,credential_response:f}},error:null}:{data:null,error:y}}case"request":{let p=(l=u.webauthn.credential_options.publicKey,h=n?.request,ct(vs,l,h||{})),{data:f,error:y}=await bs(Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:p,signal:d}));return f?{data:{factorId:e,challengeId:u.id,webauthn:{type:u.webauthn.type,credential_response:f}},error:null}:{data:null,error:y}}}}catch(u){return k(u)?{data:null,error:u}:{data:null,error:new $e("Unexpected error in challenge",u)}}}async _verify({challengeId:e,factorId:t,webauthn:s}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:s})}async _authenticate({factorId:e,webauthn:{rpId:t="u">typeof window?window.location.hostname:void 0,rpOrigins:s="u">typeof window?[window.location.origin]:void 0,signal:i}={}},n){if(!t)return{data:null,error:new Ze("rpId is required for WebAuthn authentication")};try{if(!hr())return{data:null,error:new $e("Browser does not support WebAuthn",null)};let{data:a,error:o}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:s},signal:i},{request:n});if(!a)return{data:null,error:o};let{webauthn:l}=a;return this._verify({factorId:e,challengeId:a.challengeId,webauthn:{type:l.type,rpId:t,rpOrigins:s,credential_response:l.credential_response}})}catch(a){return k(a)?{data:null,error:a}:{data:null,error:new $e("Unexpected error in authenticate",a)}}}async _register({friendlyName:e,webauthn:{rpId:t="u">typeof window?window.location.hostname:void 0,rpOrigins:s="u">typeof window?[window.location.origin]:void 0,signal:i}={}},n){if(!t)return{data:null,error:new Ze("rpId is required for WebAuthn registration")};try{if(!hr())return{data:null,error:new $e("Browser does not support WebAuthn",null)};let{data:a,error:o}=await this._enroll({friendlyName:e});if(!a)return await this.client.mfa.listFactors().then(u=>{var c;return(c=u.data)==null?void 0:c.all.find(d=>d.factor_type==="webauthn"&&d.friendly_name===e&&d.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u?.id}):void 0),{data:null,error:o};let{data:l,error:h}=await this._challenge({factorId:a.id,friendlyName:a.friendly_name,webauthn:{rpId:t,rpOrigins:s},signal:i},{create:n});return l?this._verify({factorId:a.id,challengeId:l.challengeId,webauthn:{rpId:t,rpOrigins:s,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:h}}catch(a){return k(a)?{data:null,error:a}:{data:null,error:new $e("Unexpected error in register",a)}}}}if(typeof F!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{"u">typeof pt&&(pt.globalThis=pt)}let Ss={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Zr,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function ur(r,e,t){return await t()}let Fe={};class Qe{get jwks(){var e,t;return(t=(e=Fe[this.storageKey])==null?void 0:e.jwks)!=null?t:{keys:[]}}set jwks(e){Fe[this.storageKey]=Object.assign(Object.assign({},Fe[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Fe[this.storageKey])==null?void 0:e.cachedAt)!=null?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Fe[this.storageKey]=Object.assign(Object.assign({},Fe[this.storageKey]),{cachedAt:e})}constructor(e){var t,s,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;let n=Object.assign(Object.assign({},Ss),e);if(this.storageKey=n.storageKey,this.instanceID=(t=Qe.nextInstanceID[this.storageKey])!=null?t:0,Qe.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.instanceID>0&&ce()){let a=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(a),this.logDebugMessages&&console.trace(a)}if(this.persistSession=n.persistSession,this.autoRefreshToken=n.autoRefreshToken,this.admin=new fs({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=er(n.fetch),this.lock=n.lock||ur,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,this.throwOnError=n.throwOnError,this.lockAcquireTimeout=n.lockAcquireTimeout,n.lock?this.lock=n.lock:this.persistSession&&ce()&&((s=F?.navigator)==null?void 0:s.locks)?this.lock=gs:this.lock=ur,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new ks(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:Qt()?this.storage=F.localStorage:(this.memoryStorage={},this.storage=nr(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=nr(this.memoryStorage)),ce()&&F.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new F.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}(i=this.broadcastChannel)==null||i.addEventListener("message",async a=>{this._debug("received broadcast notification from other tab or client",a),await this._notifyAllSubscribers(a.data.event,a.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Ft}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{let t={},s="none";if(ce()&&(t=function(i){let n={},a=new URL(i);if(a.hash&&a.hash[0]==="#")try{new URLSearchParams(a.hash.substring(1)).forEach((o,l)=>{n[l]=o})}catch{}return a.searchParams.forEach((o,l)=>{n[l]=o}),n}(window.location.href),this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce")),ce()&&this.detectSessionInUrl&&s!=="none"){let{data:i,error:n}=await this._getSessionFromURL(t,s);if(n)return this._debug("#_initialize()","error detecting session from URL",n),k(n)&&n.name==="AuthImplicitGrantRedirectError"&&((e=n.details)==null||e.code),{error:n};let{session:a,redirectType:o}=i;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return k(t)?this._returnResult({error:t}):this._returnResult({error:new $e("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,i;try{let{data:n,error:a}=await C(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e?.options)==null?void 0:t.data)!=null?s:{},gotrue_meta_security:{captcha_token:(i=e?.options)==null?void 0:i.captchaToken}},xform:Ae});if(a||!n)return this._returnResult({data:{user:null,session:null},error:a});let o=n.session,l=n.user;return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(n){if(k(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signUp(e){var t,s,i;try{let n;if("email"in e){let{email:u,password:c,options:d}=e,p=null,f=null;this.flowType==="pkce"&&([p,f]=await We(this.storage,this.storageKey)),n=await C(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d?.emailRedirectTo,body:{email:u,password:c,data:(t=d?.data)!=null?t:{},gotrue_meta_security:{captcha_token:d?.captchaToken},code_challenge:p,code_challenge_method:f},xform:Ae})}else if("phone"in e){let{phone:u,password:c,options:d}=e;n=await C(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:c,data:(s=d?.data)!=null?s:{},channel:(i=d?.channel)!=null?i:"sms",gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:Ae})}else throw new at("You must provide either an email or phone number and a password");let{data:a,error:o}=n;if(o||!a)return await de(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:o});let l=a.session,h=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:h,session:l},error:null})}catch(n){if(await de(this.storage,`${this.storageKey}-code-verifier`),k(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithPassword(e){try{let t;if("email"in e){let{email:n,password:a,options:o}=e;t=await C(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:a,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:sr})}else if("phone"in e){let{phone:n,password:a,options:o}=e;t=await C(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:a,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:sr})}else throw new at("You must provide either an email or phone number and a password");let{data:s,error:i}=t;if(i)return this._returnResult({data:{user:null,session:null},error:i});if(!s||!s.session||!s.user){let n=new Le;return this._returnResult({data:{user:null,session:null},error:n})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i})}catch(t){if(k(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,s,i,n;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)==null?void 0:t.redirectTo,scopes:(s=e.options)==null?void 0:s.scopes,queryParams:(i=e.options)==null?void 0:i.queryParams,skipBrowserRedirect:(n=e.options)==null?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){let{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,s,i,n,a,o,l,h,u,c,d,p;let f,y;if("message"in e)f=e.message,y=e.signature;else{let g,{chain:O,wallet:v,statement:K,options:b}=e;if(ce())if(typeof v=="object")g=v;else{let ge=window;if("ethereum"in ge&&typeof ge.ethereum=="object"&&"request"in ge.ethereum&&typeof ge.ethereum.request=="function")g=ge.ethereum;else throw Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!b?.url)throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");g=v}let W=new URL((t=b?.url)!=null?t:window.location.href),q=await g.request({method:"eth_requestAccounts"}).then(ge=>ge).catch(()=>{throw Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!q||q.length===0)throw Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");let se=or(q[0]),Ee=(s=b?.signInWithEthereum)==null?void 0:s.chainId;Ee||(Ee=parseInt(await g.request({method:"eth_chainId"}),16)),f=function(ge){var fr;let{chainId:xt,domain:Nt,expirationTime:pr,issuedAt:Cs=new Date,nonce:et,notBefore:gr,requestId:mr,resources:yr,scheme:wr,uri:br,version:Ut}=ge;if(!Number.isInteger(xt))throw Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${xt}`);if(!Nt)throw Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(et&&et.length<8)throw Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${et}`);if(!br)throw Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(Ut!=="1")throw Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${Ut}`);if((fr=ge.statement)!=null&&fr.includes(`
`))throw Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${ge.statement}`);let Ps=or(ge.address),xs=wr?`${wr}://${Nt}`:Nt,Ns=ge.statement?`${ge.statement}
`:"",Us=`${xs} wants you to sign in with your Ethereum account:
${Ps}

${Ns}`,tt=`URI: ${br}
Version: ${Ut}
Chain ID: ${xt}${et?`
Nonce: ${et}`:""}
Issued At: ${Cs.toISOString()}`;if(pr&&(tt+=`
Expiration Time: ${pr.toISOString()}`),gr&&(tt+=`
Not Before: ${gr.toISOString()}`),mr&&(tt+=`
Request ID: ${mr}`),yr){let _r=`
Resources:`;for(let ft of yr){if(!ft||typeof ft!="string")throw Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${ft}`);_r+=`
- ${ft}`}tt+=_r}return`${Us}
${tt}`}({domain:W.host,address:se,statement:K,uri:W.href,version:"1",chainId:Ee,nonce:(i=b?.signInWithEthereum)==null?void 0:i.nonce,issuedAt:(a=(n=b?.signInWithEthereum)==null?void 0:n.issuedAt)!=null?a:new Date,expirationTime:(o=b?.signInWithEthereum)==null?void 0:o.expirationTime,notBefore:(l=b?.signInWithEthereum)==null?void 0:l.notBefore,requestId:(h=b?.signInWithEthereum)==null?void 0:h.requestId,resources:(u=b?.signInWithEthereum)==null?void 0:u.resources}),y=await g.request({method:"personal_sign",params:[(p=f,"0x"+Array.from(new TextEncoder().encode(p),ge=>ge.toString(16).padStart(2,"0")).join("")),se]})}try{let{data:g,error:O}=await C(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:y},(c=e.options)!=null&&c.captchaToken?{gotrue_meta_security:{captcha_token:(d=e.options)==null?void 0:d.captchaToken}}:null),xform:Ae});if(O)throw O;if(!g||!g.session||!g.user){let v=new Le;return this._returnResult({data:{user:null,session:null},error:v})}return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),this._returnResult({data:Object.assign({},g),error:O})}catch(g){if(k(g))return this._returnResult({data:{user:null,session:null},error:g});throw g}}async signInWithSolana(e){var t,s,i,n,a,o,l,h,u,c,d,p;let f,y;if("message"in e)f=e.message,y=e.signature;else{let g,{chain:O,wallet:v,statement:K,options:b}=e;if(ce())if(typeof v=="object")g=v;else{let q=window;if("solana"in q&&typeof q.solana=="object"&&("signIn"in q.solana&&typeof q.solana.signIn=="function"||"signMessage"in q.solana&&typeof q.solana.signMessage=="function"))g=q.solana;else throw Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!b?.url)throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");g=v}let W=new URL((t=b?.url)!=null?t:window.location.href);if("signIn"in g&&g.signIn){let q,se=await g.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},b?.signInWithSolana),{version:"1",domain:W.host,uri:W.href}),K?{statement:K}:null));if(Array.isArray(se)&&se[0]&&typeof se[0]=="object")q=se[0];else if(se&&typeof se=="object"&&"signedMessage"in se&&"signature"in se)q=se;else throw Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in q&&"signature"in q&&(typeof q.signedMessage=="string"||q.signedMessage instanceof Uint8Array)&&q.signature instanceof Uint8Array)f=typeof q.signedMessage=="string"?q.signedMessage:new TextDecoder().decode(q.signedMessage),y=q.signature;else throw Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in g)||typeof g.signMessage!="function"||!("publicKey"in g)||typeof g!="object"||!g.publicKey||!("toBase58"in g.publicKey)||typeof g.publicKey.toBase58!="function")throw Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[`${W.host} wants you to sign in with your Solana account:`,g.publicKey.toBase58(),...K?["",K,""]:[""],"Version: 1",`URI: ${W.href}`,`Issued At: ${(i=(s=b?.signInWithSolana)==null?void 0:s.issuedAt)!=null?i:new Date().toISOString()}`,...(n=b?.signInWithSolana)!=null&&n.notBefore?[`Not Before: ${b.signInWithSolana.notBefore}`]:[],...(a=b?.signInWithSolana)!=null&&a.expirationTime?[`Expiration Time: ${b.signInWithSolana.expirationTime}`]:[],...(o=b?.signInWithSolana)!=null&&o.chainId?[`Chain ID: ${b.signInWithSolana.chainId}`]:[],...(l=b?.signInWithSolana)!=null&&l.nonce?[`Nonce: ${b.signInWithSolana.nonce}`]:[],...(h=b?.signInWithSolana)!=null&&h.requestId?[`Request ID: ${b.signInWithSolana.requestId}`]:[],...(c=(u=b?.signInWithSolana)==null?void 0:u.resources)!=null&&c.length?["Resources",...b.signInWithSolana.resources.map(se=>`- ${se}`)]:[]].join(`
`);let q=await g.signMessage(new TextEncoder().encode(f),"utf8");if(!q||!(q instanceof Uint8Array))throw Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=q}}try{let{data:g,error:O}=await C(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:Ce(y)},(d=e.options)!=null&&d.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)==null?void 0:p.captchaToken}}:null),xform:Ae});if(O)throw O;if(!g||!g.session||!g.user){let v=new Le;return this._returnResult({data:{user:null,session:null},error:v})}return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),this._returnResult({data:Object.assign({},g),error:O})}catch(g){if(k(g))return this._returnResult({data:{user:null,session:null},error:g});throw g}}async _exchangeCodeForSession(e){let t=await xe(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(t??"").split("/");try{if(!s&&this.flowType==="pkce")throw new ts;let{data:n,error:a}=await C(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:Ae});if(await de(this.storage,`${this.storageKey}-code-verifier`),a)throw a;if(!n||!n.session||!n.user){let o=new Le;return this._returnResult({data:{user:null,session:null,redirectType:null},error:o})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign(Object.assign({},n),{redirectType:i??null}),error:a})}catch(n){if(await de(this.storage,`${this.storageKey}-code-verifier`),k(n))return this._returnResult({data:{user:null,session:null,redirectType:null},error:n});throw n}}async signInWithIdToken(e){try{let{options:t,provider:s,token:i,access_token:n,nonce:a}=e,{data:o,error:l}=await C(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:n,nonce:a,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Ae});if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!o||!o.session||!o.user){let h=new Le;return this._returnResult({data:{user:null,session:null},error:h})}return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),this._returnResult({data:o,error:l})}catch(t){if(k(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,s,i,n,a;try{if("email"in e){let{email:o,options:l}=e,h=null,u=null;this.flowType==="pkce"&&([h,u]=await We(this.storage,this.storageKey));let{error:c}=await C(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=l?.data)!=null?t:{},create_user:(s=l?.shouldCreateUser)==null||s,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:h,code_challenge_method:u},redirectTo:l?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:c})}if("phone"in e){let{phone:o,options:l}=e,{data:h,error:u}=await C(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(i=l?.data)!=null?i:{},create_user:(n=l?.shouldCreateUser)==null||n,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(a=l?.channel)!=null?a:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:h?.message_id},error:u})}throw new at("You must provide either an email or phone number.")}catch(o){if(await de(this.storage,`${this.storageKey}-code-verifier`),k(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async verifyOtp(e){var t,s;try{let i,n;"options"in e&&(i=(t=e.options)==null?void 0:t.redirectTo,n=(s=e.options)==null?void 0:s.captchaToken);let{data:a,error:o}=await C(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:i,xform:Ae});if(o)throw o;if(!a)throw Error("An error occurred on token verification.");let l=a.session,h=a.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:h,session:l},error:null})}catch(i){if(k(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithSSO(e){var t,s,i,n,a;try{let o=null,l=null;this.flowType==="pkce"&&([o,l]=await We(this.storage,this.storageKey));let h=await C(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)==null?void 0:t.redirectTo)!=null?s:void 0}),(i=e?.options)!=null&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:l}),headers:this.headers,xform:cs});return((n=h.data)==null?void 0:n.url)&&ce()&&!((a=e.options)!=null&&a.skipBrowserRedirect)&&window.location.assign(h.data.url),this._returnResult(h)}catch(o){if(await de(this.storage,`${this.storageKey}-code-verifier`),k(o))return this._returnResult({data:null,error:o});throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{let{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new ke;let{error:i}=await C(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:i})})}catch(e){if(k(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{let t=`${this.url}/resend`;if("email"in e){let{email:s,type:i,options:n}=e,{error:a}=await C(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:n?.captchaToken}},redirectTo:n?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:a})}if("phone"in e){let{phone:s,type:i,options:n}=e,{data:a,error:o}=await C(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:n?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:a?.message_id},error:o})}throw new at("You must provide either an email or phone number and a type")}catch(t){if(k(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){let i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{let t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",Error().stack);try{let t=null,s=await xe(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?t=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};let i=!!t.expires_at&&1e3*t.expires_at-Date.now()<9e4;if(this._debug("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",t.expires_at),!i){if(this.userStorage){let o=await xe(this.userStorage,this.storageKey+"-user");o?.user?t.user=o.user:t.user=Ct()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){var e;let o={value:this.suppressGetSessionWarning};t.user=(e=t.user,new Proxy(e,{get:(l,h,u)=>{if(h==="__isInsecureUserWarningProxy")return!0;if(typeof h=="symbol"){let c=h.toString();if(c==="Symbol(Symbol.toPrimitive)"||c==="Symbol(Symbol.toStringTag)"||c==="Symbol(util.inspect.custom)"||c==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(l,h,u)}return o.value||typeof h!="string"||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o.value=!0),Reflect.get(l,h,u)}})),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}let{data:n,error:a}=await this._callRefreshToken(t.refresh_token);return a?this._returnResult({data:{session:null},error:a}):this._returnResult({data:{session:n},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;let t=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{return e?await C(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ie}):await this._useSession(async t=>{var s,i,n;let{data:a,error:o}=t;if(o)throw o;return((s=a.session)==null?void 0:s.access_token)||this.hasCustomAuthorizationHeader?await C(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(n=(i=a.session)==null?void 0:i.access_token)!=null?n:void 0,xform:Ie}):{data:{user:null},error:new ke}})}catch(t){if(k(t))return k(t)&&t.name==="AuthSessionMissingError"&&(await this._removeSession(),await de(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{let{data:i,error:n}=s;if(n)throw n;if(!i.session)throw new ke;let a=i.session,o=null,l=null;this.flowType==="pkce"&&e.email!=null&&([o,l]=await We(this.storage,this.storageKey));let{data:h,error:u}=await C(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:l}),jwt:a.access_token,xform:Ie});if(u)throw u;return a.user=h.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),this._returnResult({data:{user:a.user},error:null})})}catch(s){if(await de(this.storage,`${this.storageKey}-code-verifier`),k(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new ke;let t=Date.now()/1e3,s=t,i=!0,n=null,{payload:a}=$t(e.access_token);if(a.exp&&(i=(s=a.exp)<=t),i){let{data:o,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!o)return{data:{user:null,session:null},error:null};n=o}else{let{data:o,error:l}=await this._getUser(e.access_token);if(l)throw l;n={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return this._returnResult({data:{user:n.user,session:n},error:null})}catch(t){if(k(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){let{data:a,error:o}=t;if(o)throw o;e=(s=a.session)!=null?s:void 0}if(!e?.refresh_token)throw new ke;let{data:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?this._returnResult({data:{user:null,session:null},error:n}):i?this._returnResult({data:{user:i.user,session:i},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(k(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!ce())throw new ot("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ot(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new zt("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ot("Not a valid implicit grant flow url.")}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new zt("No code detected.");let{data:v,error:K}=await this._exchangeCodeForSession(e.code);if(K)throw K;let b=new URL(window.location.href);return b.searchParams.delete("code"),window.history.replaceState(window.history.state,"",b.toString()),{data:{session:v.session,redirectType:null},error:null}}let{provider_token:s,provider_refresh_token:i,access_token:n,refresh_token:a,expires_in:o,expires_at:l,token_type:h}=e;if(!n||!o||!a||!h)throw new ot("No session defined in URL");let u=Math.round(Date.now()/1e3),c=parseInt(o),d=u+c;l&&(d=parseInt(l));let p=d-u;1e3*p<=3e4&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${c}s`);let f=d-c;u-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,d,u):u-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",f,d,u);let{data:y,error:g}=await this._getUser(n);if(g)throw g;let O={provider_token:s,provider_refresh_token:i,access_token:n,expires_in:c,expires_at:d,refresh_token:a,token_type:h,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:O,redirectType:e.type},error:null})}catch(s){if(k(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){let t=await xe(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;let{data:i,error:n}=t;if(n)return this._returnResult({error:n});let a=(s=i.session)==null?void 0:s.access_token;if(a){let{error:o}=await this.admin.signOut(a,e);if(o&&!(k(o)&&o.name==="AuthApiError"&&(o.status===404||o.status===401||o.status===403)))return this._returnResult({error:o})}return e!=="others"&&(await this._removeSession(),await de(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){let t=Symbol("auth-callback"),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,i;try{let{data:{session:n},error:a}=t;if(a)throw a;await((s=this.stateChangeEmitters.get(e))==null?void 0:s.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){await((i=this.stateChangeEmitters.get(e))==null?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let s=null,i=null;this.flowType==="pkce"&&([s,i]=await We(this.storage,this.storageKey,!0));try{return await C(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(await de(this.storage,`${this.storageKey}-code-verifier`),k(n))return this._returnResult({data:null,error:n});throw n}}async getUserIdentities(){var e;try{let{data:t,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:(e=t.user.identities)!=null?e:[]},error:null})}catch(t){if(k(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{let{data:s,error:i}=await this._useSession(async n=>{var a,o,l,h,u;let{data:c,error:d}=n;if(d)throw d;let p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)==null?void 0:a.redirectTo,scopes:(o=e.options)==null?void 0:o.scopes,queryParams:(l=e.options)==null?void 0:l.queryParams,skipBrowserRedirect:!0});return await C(this.fetch,"GET",p,{headers:this.headers,jwt:(u=(h=c.session)==null?void 0:h.access_token)!=null?u:void 0})});if(i)throw i;return!ce()||((t=e.options)==null?void 0:t.skipBrowserRedirect)||window.location.assign(s?.url),this._returnResult({data:{provider:e.provider,url:s?.url},error:null})}catch(s){if(k(s))return this._returnResult({data:{provider:e.provider,url:null},error:s});throw s}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var s;try{let{error:i,data:{session:n}}=t;if(i)throw i;let{options:a,provider:o,token:l,access_token:h,nonce:u}=e,{data:c,error:d}=await C(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=n?.access_token)!=null?s:void 0,body:{provider:o,id_token:l,access_token:h,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Ae});return d?this._returnResult({data:{user:null,session:null},error:d}):!c||!c.session||!c.user?this._returnResult({data:{user:null,session:null},error:new Le}):(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("USER_UPDATED",c.session)),this._returnResult({data:c,error:d}))}catch(i){if(await de(this.storage,`${this.storageKey}-code-verifier`),k(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,i;let{data:n,error:a}=t;if(a)throw a;return await C(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(s=n.session)==null?void 0:s.access_token)!=null?i:void 0})})}catch(t){if(k(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){let t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{var s,i;let n=Date.now();return await(s=async a=>(a>0&&await ss(200*Math.pow(2,a-1)),this._debug(t,"refreshing attempt",a),await C(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Ae})),i=(a,o)=>{let l=200*Math.pow(2,a);return o&&jt(o)&&Date.now()+l-n<3e4},new Promise((a,o)=>{(async()=>{for(let l=0;l<1/0;l++)try{let h=await s(l);if(!i(l,null,h))return void a(h)}catch(h){if(!i(l,h))return void o(h)}})()}))}catch(n){if(this._debug(t,"error",n),k(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){let s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),ce()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;let s="#_recoverAndRefresh()";this._debug(s,"begin");try{let i=await xe(this.storage,this.storageKey);if(i&&this.userStorage){let a=await xe(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:i.user},await Ke(this.userStorage,this.storageKey+"-user",a)),i.user=(e=a?.user)!=null?e:Ct()}else if(i&&!i.user&&!i.user){let a=await xe(this.storage,this.storageKey+"-user");a&&a?.user?(i.user=a.user,await de(this.storage,this.storageKey+"-user"),await Ke(this.storage,this.storageKey,i)):i.user=Ct()}if(this._debug(s,"session from storage",i),!this._isValidSession(i)){this._debug(s,"session is not valid"),i!==null&&await this._removeSession();return}let n=((t=i.expires_at)!=null?t:1/0)*1e3-Date.now()<9e4;if(this._debug(s,`session has${n?"":" not"} expired with margin of 90000s`),n){if(this.autoRefreshToken&&i.refresh_token){let{error:a}=await this._callRefreshToken(i.refresh_token);a&&(console.error(a),jt(a)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{let{data:a,error:o}=await this._getUser(i.access_token);!o&&a?.user?(i.user=a.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(s,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(s,"error",i),console.error(i);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new ke;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new ht;let{data:n,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!n.session)throw new ke;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);let o={data:n.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(n){if(this._debug(i,"error",n),k(n)){let a={data:null,error:n};return jt(n)||await this._removeSession(),(t=this.refreshingDeferred)==null||t.resolve(a),a}throw(s=this.refreshingDeferred)==null||s.reject(n),n}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,s=!0){let i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});let n=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(l){n.push(l)}});if(await Promise.all(a),n.length>0){for(let o=0;o<n.length;o+=1)console.error(n[o]);throw n[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await de(this.storage,`${this.storageKey}-code-verifier`);let t=Object.assign({},e),s=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&t.user&&await Ke(this.userStorage,this.storageKey+"-user",{user:t.user});let i=Object.assign({},t);delete i.user;let n=tr(i);await Ke(this.storage,this.storageKey,n)}else{let i=tr(t);await Ke(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await de(this.storage,this.storageKey),await de(this.storage,this.storageKey+"-code-verifier"),await de(this.storage,this.storageKey+"-user"),this.userStorage&&await de(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ce()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),3e4);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():"u">typeof Deno&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e);let t=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():"u">typeof Deno&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);let t=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,t&&clearTimeout(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let e=Date.now();try{return await this._useSession(async t=>{let{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");let i=Math.floor((1e3*s.expires_at-e)/3e4);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),i<=3&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof ar)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ce()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){let t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{document.visibilityState!=="visible"?this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting"):await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){let i=[`provider=${encodeURIComponent(t)}`];if(s?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s?.scopes&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){let[n,a]=await We(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(a)}`});i.push(o.toString())}if(s?.queryParams){let n=new URLSearchParams(s.queryParams);i.push(n.toString())}return s?.skipBrowserRedirect&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;let{data:i,error:n}=t;return n?this._returnResult({data:null,error:n}):await C(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=i?.session)==null?void 0:s.access_token})})}catch(t){if(k(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,i;let{data:n,error:a}=t;if(a)return this._returnResult({data:null,error:a});let o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:h}=await C(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(s=n?.session)==null?void 0:s.access_token});return h?this._returnResult({data:null,error:h}):(e.factorType==="totp"&&l.type==="totp"&&((i=l?.totp)==null?void 0:i.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(t){if(k(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var s,i,n;let{data:a,error:o}=t;if(o)return this._returnResult({data:null,error:o});let l=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?(i=e.webauthn.credential_response,"toJSON"in i&&typeof i.toJSON=="function"?i.toJSON():{id:i.id,rawId:i.id,response:{attestationObject:Ce(new Uint8Array(i.response.attestationObject)),clientDataJSON:Ce(new Uint8Array(i.response.clientDataJSON))},type:"public-key",clientExtensionResults:i.getClientExtensionResults(),authenticatorAttachment:(n=i.authenticatorAttachment)!=null?n:void 0}):function(c){var d;if("toJSON"in c&&typeof c.toJSON=="function")return c.toJSON();let p=c.getClientExtensionResults(),f=c.response;return{id:c.id,rawId:c.id,response:{authenticatorData:Ce(new Uint8Array(f.authenticatorData)),clientDataJSON:Ce(new Uint8Array(f.clientDataJSON)),signature:Ce(new Uint8Array(f.signature)),userHandle:f.userHandle?Ce(new Uint8Array(f.userHandle)):void 0},type:"public-key",clientExtensionResults:p,authenticatorAttachment:(d=c.authenticatorAttachment)!=null?d:void 0}}(e.webauthn.credential_response)})}:{code:e.code}),{data:h,error:u}=await C(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:l,headers:this.headers,jwt:(s=a?.session)==null?void 0:s.access_token});return u?this._returnResult({data:null,error:u}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+h.expires_in},h)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",h),this._returnResult({data:h,error:u}))})}catch(t){if(k(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var s;let{data:i,error:n}=t;if(n)return this._returnResult({data:null,error:n});let a=await C(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(s=i?.session)==null?void 0:s.access_token});if(a.error)return a;let{data:o}=a;if(o.type!=="webauthn")return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:function(l){if(!l)throw Error("Credential creation options are required");if("u">typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(l);let{challenge:h,user:u,excludeCredentials:c}=l,d=le(l,["challenge","user","excludeCredentials"]),p=Be(h).buffer,f=Object.assign(Object.assign({},u),{id:Be(u.id).buffer}),y=Object.assign(Object.assign({},d),{challenge:p,user:f});if(c&&c.length>0){y.excludeCredentials=Array(c.length);for(let g=0;g<c.length;g++){let O=c[g];y.excludeCredentials[g]=Object.assign(Object.assign({},O),{id:Be(O.id).buffer,type:O.type||"public-key",transports:O.transports})}}return y}(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:function(l){if(!l)throw Error("Credential request options are required");if("u">typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(l);let{challenge:h,allowCredentials:u}=l,c=le(l,["challenge","allowCredentials"]),d=Be(h).buffer,p=Object.assign(Object.assign({},c),{challenge:d});if(u&&u.length>0){p.allowCredentials=Array(u.length);for(let f=0;f<u.length;f++){let y=u[f];p.allowCredentials[f]=Object.assign(Object.assign({},y),{id:Be(y.id).buffer,type:y.type||"public-key",transports:y.transports})}}return p}(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(k(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){let{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;let{data:{user:t},error:s}=await this.getUser();if(s)return{data:null,error:s};let i={all:[],phone:[],totp:[],webauthn:[]};for(let n of(e=t?.factors)!=null?e:[])i.all.push(n),n.status==="verified"&&i[n.factor_type].push(n);return{data:i,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;let{data:{session:s},error:i}=await this.getSession();if(i)return this._returnResult({data:null,error:i});if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let{payload:n}=$t(s.access_token),a=null;n.aal&&(a=n.aal);let o=a;return((t=(e=s.user.factors)==null?void 0:e.filter(l=>l.status==="verified"))!=null?t:[]).length>0&&(o="aal2"),{data:{currentLevel:a,nextLevel:o,currentAuthenticationMethods:n.amr||[]},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{let{data:{session:s},error:i}=t;return i?this._returnResult({data:null,error:i}):s?await C(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:s.access_token,xform:n=>({data:n,error:null})}):this._returnResult({data:null,error:new ke})})}catch(t){if(k(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async s=>{let{data:{session:i},error:n}=s;if(n)return this._returnResult({data:null,error:n});if(!i)return this._returnResult({data:null,error:new ke});let a=await C(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"approve"},xform:o=>({data:o,error:null})});return a.data&&a.data.redirect_url&&ce()&&!t?.skipBrowserRedirect&&window.location.assign(a.data.redirect_url),a})}catch(s){if(k(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(e,t){try{return await this._useSession(async s=>{let{data:{session:i},error:n}=s;if(n)return this._returnResult({data:null,error:n});if(!i)return this._returnResult({data:null,error:new ke});let a=await C(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"deny"},xform:o=>({data:o,error:null})});return a.data&&a.data.redirect_url&&ce()&&!t?.skipBrowserRedirect&&window.location.assign(a.data.redirect_url),a})}catch(s){if(k(s))return this._returnResult({data:null,error:s});throw s}}async _listOAuthGrants(){try{return await this._useSession(async e=>{let{data:{session:t},error:s}=e;return s?this._returnResult({data:null,error:s}):t?await C(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new ke})})}catch(e){if(k(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{let{data:{session:s},error:i}=t;return i?this._returnResult({data:null,error:i}):s?(await C(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new ke})})}catch(t){if(k(t))return this._returnResult({data:null,error:t});throw t}}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(o=>o.kid===e);if(s)return s;let i=Date.now();if((s=this.jwks.keys.find(o=>o.kid===e))&&this.jwks_cached_at+6e5>i)return s;let{data:n,error:a}=await C(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return n.keys&&n.keys.length!==0&&(this.jwks=n,this.jwks_cached_at=i,s=n.keys.find(o=>o.kid===e))?s:null}async getClaims(e,t={}){try{var s;let i,n=e;if(!n){let{data:f,error:y}=await this.getSession();if(y||!f.session)return this._returnResult({data:null,error:y});n=f.session.access_token}let{header:a,payload:o,signature:l,raw:{header:h,payload:u}}=$t(n);t?.allowExpired||function(f){if(!f)throw Error("Missing exp claim");if(f<=Math.floor(Date.now()/1e3))throw Error("JWT has expired")}(o.exp);let c=!a.alg||a.alg.startsWith("HS")||!a.kid||!("crypto"in F&&"subtle"in F.crypto)?null:await this.fetchJwk(a.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!c){let{error:f}=await this.getUser(n);if(f)throw f;return{data:{claims:o,header:a,signature:l},error:null}}let d=function(f){switch(f){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw Error("Invalid alg claim")}}(a.alg),p=await crypto.subtle.importKey("jwk",c,d,!0,["verify"]);if(!await crypto.subtle.verify(d,p,l,(s=`${h}.${u}`,i=[],function(f,y){for(let g=0;g<f.length;g+=1){let O=f.charCodeAt(g);if(O>55295&&O<=56319){let v=(O-55296)*1024&65535;O=(f.charCodeAt(g+1)-56320&65535|v)+65536,g+=1}(function(v,K){if(v<=127)return K(v);if(v<=2047){K(192|v>>6),K(128|63&v);return}if(v<=65535){K(224|v>>12),K(128|v>>6&63),K(128|63&v);return}if(v<=1114111){K(240|v>>18),K(128|v>>12&63),K(128|v>>6&63),K(128|63&v);return}throw Error(`Unrecognized Unicode codepoint: ${v.toString(16)}`)})(O,y)}}(s,f=>i.push(f)),new Uint8Array(i))))throw new It("Invalid JWT signature");return{data:{claims:o,header:a,signature:l},error:null}}catch(i){if(k(i))return this._returnResult({data:null,error:i});throw i}}}Qe.nextInstanceID={};let Es=Qe,cr="";cr="u">typeof Deno?"deno":"u">typeof document?"web":"u">typeof navigator&&navigator.product==="ReactNative"?"react-native":"node";let Ts={headers:{"X-Client-Info":`supabase-js-${cr}/2.90.1`}},Os={schema:"public"},Rs={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},As={};function dt(r){return(dt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(r)}function dr(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,s)}return t}function re(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?dr(Object(t),!0).forEach(function(s){(function(i,n,a){var o;o=function(l,h){if(dt(l)!="object"||!l)return l;var u=l[Symbol.toPrimitive];if(u!==void 0){var c=u.call(l,h||"default");if(dt(c)!="object")return c;throw TypeError("@@toPrimitive must return a primitive value.")}return(h==="string"?String:Number)(l)}(n,"string"),(n=dt(o)=="symbol"?o:o+"")in i?Object.defineProperty(i,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[n]=a})(r,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):dr(Object(t)).forEach(function(s){Object.defineProperty(r,s,Object.getOwnPropertyDescriptor(t,s))})}return r}var js=class extends Es{constructor(r){super(r)}},Is=class{constructor(r,e,t){var s,i,n;this.supabaseUrl=r,this.supabaseKey=e;let a=function(h){let u=h?.trim();if(!u)throw Error("supabaseUrl is required.");if(!u.match(/^https?:\/\//i))throw Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(u.endsWith("/")?u:u+"/")}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}(r);if(!e)throw Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);let o=`sb-${a.hostname.split(".")[0]}-auth-token`,l=function(h,u){var c,d;let{db:p,auth:f,realtime:y,global:g}=h,{db:O,auth:v,realtime:K,global:b}=u,W={db:re(re({},O),p),auth:re(re({},v),f),realtime:re(re({},K),y),storage:{},global:re(re(re({},b),g),{},{headers:re(re({},(c=b?.headers)!=null?c:{}),(d=g?.headers)!=null?d:{})}),accessToken:async()=>""};return h.accessToken?W.accessToken=h.accessToken:delete W.accessToken,W}(t??{},{db:Os,realtime:As,auth:re(re({},Rs),{},{storageKey:o}),global:Ts});this.storageKey=(s=l.auth.storageKey)!=null?s:"",this.headers=(i=l.global.headers)!=null?i:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(h,u)=>{throw Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(u)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((n=l.auth)!=null?n:{},this.headers,l.global.fetch),this.fetch=((h,u,c)=>{let d=c?(...f)=>c(...f):(...f)=>fetch(...f),p=Headers;return async(f,y)=>{var g;let O=(g=await u())!=null?g:h,v=new p(y?.headers);return v.has("apikey")||v.set("apikey",h),v.has("Authorization")||v.set("Authorization",`Bearer ${O}`),d(f,re(re({},y),{},{headers:v}))}})(e,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(re({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&this.accessToken().then(h=>this.realtime.setAuth(h)).catch(h=>console.warn("Failed to set initial Realtime auth token:",h)),this.rest=new H(new URL("rest/v1",a).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new Xr(this.storageUrl.href,this.headers,this.fetch,t?.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new we(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(r){return this.rest.from(r)}schema(r){return this.rest.schema(r)}rpc(r,e={},t={head:!1,get:!1,count:void 0}){return this.rest.rpc(r,e,t)}channel(r,e={config:{}}){return this.realtime.channel(r,e)}getChannels(){return this.realtime.getChannels()}removeChannel(r){return this.realtime.removeChannel(r)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var r,e;if(this.accessToken)return await this.accessToken();let{data:t}=await this.auth.getSession();return(r=(e=t.session)==null?void 0:e.access_token)!=null?r:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:r,persistSession:e,detectSessionInUrl:t,storage:s,userStorage:i,storageKey:n,flowType:a,lock:o,debug:l,throwOnError:h},u,c){let d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new js({url:this.authUrl.href,headers:re(re({},d),u),storageKey:n,autoRefreshToken:r,persistSession:e,detectSessionInUrl:t,storage:s,userStorage:i,flowType:a,lock:o,debug:l,throwOnError:h,fetch:c,hasCustomAuthorizationHeader:Object.keys(this.headers).some(p=>p.toLowerCase()==="authorization")})}_initRealtimeClient(r){return new Ar(this.realtimeUrl.href,re(re({},r),{},{params:re(re({},{apikey:this.supabaseKey}),r?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,e)=>{this._handleTokenChanged(r,"CLIENT",e?.access_token)})}_handleTokenChanged(r,e,t){(r==="TOKEN_REFRESHED"||r==="SIGNED_IN")&&this.changedAccessToken!==t?(this.changedAccessToken=t,this.realtime.setAuth(t)):r==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};let $s=(r,e,t)=>new Is(r,e,t);(function(){if("u">typeof window)return!1;let r=F.process;if(!r)return!1;let e=r.version;if(e==null)return!1;let t=e.match(/^v(\d+)\./);return!!t&&18>=parseInt(t[1],10)})()&&console.warn("\u26A0\uFE0F  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217")},Ue.__chunk_6270=(Ve,ye)=>{let U;ye.qg=function(M,X){let L=new fe,m=M.length;if(m<2)return L;let P=X?.decode||ue,E=0;do{let w=function(T,_,j){let B=T.indexOf("=",_);return B<j?B:-1}(M,E,m);if(w===-1)break;let R=function(T,_,j){let B=T.indexOf(";",_);return B===-1?j:B}(M,E,m);if(w>R){E=M.lastIndexOf(";",w-1)+1;continue}let I=V(M,E,w);L[I]===void 0&&(L[I]=P(V(M,w+1,R))),E=R+1}while(E<m);return L},ye.lK=we,ye.lK=we;let oe=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,le=/^[\u0021-\u003A\u003C-\u007E]*$/,ie=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,he=/^[\u0020-\u003A\u003D-\u007E]*$/,te=Object.prototype.toString,fe=((U=function(){}).prototype=Object.create(null),U);function we(M,X,L){let m=typeof M=="object"?M:{...L,name:M,value:String(X)},P=(typeof X=="object"?X:L)?.encode||encodeURIComponent;if(!oe.test(m.name))throw TypeError(`argument name is invalid: ${m.name}`);let E=m.value?P(m.value):"";if(!le.test(E))throw TypeError(`argument val is invalid: ${m.value}`);let w=m.name+"="+E;if(m.maxAge!==void 0){if(!Number.isInteger(m.maxAge))throw TypeError(`option maxAge is invalid: ${m.maxAge}`);w+="; Max-Age="+m.maxAge}if(m.domain){if(!ie.test(m.domain))throw TypeError(`option domain is invalid: ${m.domain}`);w+="; Domain="+m.domain}if(m.path){if(!he.test(m.path))throw TypeError(`option path is invalid: ${m.path}`);w+="; Path="+m.path}if(m.expires){var R;if(R=m.expires,te.call(R)!=="[object Date]"||!Number.isFinite(m.expires.valueOf()))throw TypeError(`option expires is invalid: ${m.expires}`);w+="; Expires="+m.expires.toUTCString()}if(m.httpOnly&&(w+="; HttpOnly"),m.secure&&(w+="; Secure"),m.partitioned&&(w+="; Partitioned"),m.priority)switch(typeof m.priority=="string"?m.priority.toLowerCase():void 0){case"low":w+="; Priority=Low";break;case"medium":w+="; Priority=Medium";break;case"high":w+="; Priority=High";break;default:throw TypeError(`option priority is invalid: ${m.priority}`)}if(m.sameSite)switch(typeof m.sameSite=="string"?m.sameSite.toLowerCase():m.sameSite){case!0:case"strict":w+="; SameSite=Strict";break;case"lax":w+="; SameSite=Lax";break;case"none":w+="; SameSite=None";break;default:throw TypeError(`option sameSite is invalid: ${m.sameSite}`)}return w}function V(M,X,L){let m=X,P=L;do{let E=M.charCodeAt(m);if(E!==32&&E!==9)break}while(++m<P);for(;P>m;){let E=M.charCodeAt(P-1);if(E!==32&&E!==9)break;P--}return M.slice(m,P)}function ue(M){if(M.indexOf("%")===-1)return M;try{return decodeURIComponent(M)}catch{return M}}},Ue.__chunk_4863=(Ve,ye,U)=>{U.d(ye,{createServerClient:()=>w});var oe=U(6270);function le(){return"u">typeof window&&window.document!==void 0}oe.qg,oe.lK;let ie={path:"/",sameSite:"lax",httpOnly:!1,maxAge:3456e4},he=/^(.*)[.](0|[1-9][0-9]*)$/;function te(R,I){if(R===I)return!0;let T=R.match(he);return!!T&&T[1]===I}function fe(R,I,T){let _=T??3180,j=encodeURIComponent(I);if(j.length<=_)return[{name:R,value:I}];let B=[];for(;j.length>0;){let S=j.slice(0,_),x=S.lastIndexOf("%");x>_-3&&(S=S.slice(0,x));let N="";for(;S.length>0;)try{N=decodeURIComponent(S);break}catch(A){if(A instanceof URIError&&S.at(-3)==="%"&&S.length>3)S=S.slice(0,S.length-3);else throw A}B.push(N),j=j.slice(S.length)}return B.map((S,x)=>({name:`${R}.${x}`,value:S}))}async function we(R,I){let T=await I(R);if(T)return T;let _=[];for(let j=0;;j++){let B=`${R}.${j}`,S=await I(B);if(!S)break;_.push(S)}return _.length>0?_.join(""):null}let V="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ue=` 	
\r=`.split(""),M=(()=>{let R=Array(128);for(let I=0;I<R.length;I+=1)R[I]=-1;for(let I=0;I<ue.length;I+=1)R[ue[I].charCodeAt(0)]=-2;for(let I=0;I<V.length;I+=1)R[V[I].charCodeAt(0)]=I;return R})();function X(R){let I=[],T=0,_=0;if(function(j,B){for(let S=0;S<j.length;S+=1){let x=j.charCodeAt(S);if(x>55295&&x<=56319){let N=(x-55296)*1024&65535;x=(j.charCodeAt(S+1)-56320&65535|N)+65536,S+=1}(function(N,A){if(N<=127)return A(N);if(N<=2047){A(192|N>>6),A(128|63&N);return}if(N<=65535){A(224|N>>12),A(128|N>>6&63),A(128|63&N);return}if(N<=1114111){A(240|N>>18),A(128|N>>12&63),A(128|N>>6&63),A(128|63&N);return}throw Error(`Unrecognized Unicode codepoint: ${N.toString(16)}`)})(x,B)}}(R,j=>{for(T=T<<8|j,_+=8;_>=6;){let B=T>>_-6&63;I.push(V[B]),_-=6}}),_>0)for(T<<=6-_,_=6;_>=6;){let j=T>>_-6&63;I.push(V[j]),_-=6}return I.join("")}function L(R){let I=[],T=S=>{I.push(String.fromCodePoint(S))},_={utf8seq:0,codepoint:0},j=0,B=0;for(let S=0;S<R.length;S+=1){let x=M[R.charCodeAt(S)];if(x>-1)for(j=j<<6|x,B+=6;B>=8;)(function(N,A,Z){if(A.utf8seq===0){if(N<=127)return Z(N);for(let J=1;J<6;J+=1)if((N>>7-J&1)==0){A.utf8seq=J;break}if(A.utf8seq===2)A.codepoint=31&N;else if(A.utf8seq===3)A.codepoint=15&N;else if(A.utf8seq===4)A.codepoint=7&N;else throw Error("Invalid UTF-8 sequence");A.utf8seq-=1}else if(A.utf8seq>0){if(N<=127)throw Error("Invalid UTF-8 sequence");A.codepoint=A.codepoint<<6|63&N,A.utf8seq-=1,A.utf8seq===0&&Z(A.codepoint)}})(j>>B-8&255,_,T),B-=8;else{if(x===-2)continue;throw Error(`Invalid Base64-URL character "${R.at(S)}" at position ${S}`)}}return I.join("")}let m="base64-";async function P({getAll:R,setAll:I,setItems:T,removedItems:_},j){let B=j.cookieEncoding,S=j.cookieOptions??null,x=await R([...T?Object.keys(T):[],..._?Object.keys(_):[]]),N=x?.map(({name:G})=>G)||[],A=Object.keys(_).flatMap(G=>N.filter(Te=>te(Te,G))),Z=Object.keys(T).flatMap(G=>{let Te=new Set(N.filter(D=>te(D,G))),be=T[G];B==="base64url"&&(be=m+X(be));let me=fe(G,be);return me.forEach(D=>{Te.delete(D.name)}),A.push(...Te),me}),J={...ie,...S,maxAge:0},pe={...ie,...S,maxAge:ie.maxAge};delete J.name,delete pe.name,await I([...A.map(G=>({name:G,value:"",options:J})),...Z.map(({name:G,value:Te})=>({name:G,value:Te,options:pe}))])}var E=U(7895);function w(R,I,T){if(!R||!I)throw Error(`Your project's URL and Key are required to create a Supabase client!

Check your Supabase project's API settings to find these values

https://supabase.com/dashboard/project/_/settings/api`);let{storage:_,getAll:j,setAll:B,setItems:S,removedItems:x}=function(A,Z){let J,pe,G=A.cookies??null,Te=A.cookieEncoding,be={},me={};if(G)if("get"in G){let D=async H=>{let z=H.flatMap(Y=>[Y,...Array.from({length:5}).map((ne,Oe)=>`${Y}.${Oe}`)]),Q=[];for(let Y=0;Y<z.length;Y+=1){let ne=await G.get(z[Y]);(ne||typeof ne=="string")&&Q.push({name:z[Y],value:ne})}return Q};if(J=async H=>await D(H),"set"in G&&"remove"in G)pe=async H=>{for(let z=0;z<H.length;z+=1){let{name:Q,value:Y,options:ne}=H[z];Y?await G.set(Q,Y,ne):await G.remove(Q,ne)}};else if(Z)pe=async()=>{console.warn("@supabase/ssr: createServerClient was configured without set and remove cookie methods, but the client needs to set cookies. This can lead to issues such as random logouts, early session termination or increased token refresh requests. If in NextJS, check your middleware.ts file, route handlers and server actions for correctness. Consider switching to the getAll and setAll cookie methods instead of get, set and remove which are deprecated and can be difficult to use correctly.")};else throw Error("@supabase/ssr: createBrowserClient requires configuring a getAll and setAll cookie method (deprecated: alternatively both get, set and remove can be used)")}else if("getAll"in G)if(J=async()=>await G.getAll(),"setAll"in G)pe=G.setAll;else if(Z)pe=async()=>{console.warn("@supabase/ssr: createServerClient was configured without the setAll cookie method, but the client needs to set cookies. This can lead to issues such as random logouts, early session termination or increased token refresh requests. If in NextJS, check your middleware.ts file, route handlers and server actions for correctness.")};else throw Error("@supabase/ssr: createBrowserClient requires configuring both getAll and setAll cookie methods (deprecated: alternatively both get, set and remove can be used)");else throw Error(`@supabase/ssr: ${Z?"createServerClient":"createBrowserClient"} requires configuring getAll and setAll cookie methods (deprecated: alternatively use get, set and remove).${le()?" As this is called in a browser runtime, consider removing the cookies option object to use the document.cookie API automatically.":""}`);else if(!Z&&le())J=()=>{let D;return Object.keys(D=(0,oe.qg)(document.cookie)).map(H=>({name:H,value:D[H]??""}))},pe=D=>{D.forEach(({name:H,value:z,options:Q})=>{document.cookie=(0,oe.lK)(H,z,Q)})};else{if(Z)throw Error("@supabase/ssr: createServerClient must be initialized with cookie options that specify getAll and setAll functions (deprecated, not recommended: alternatively use get, set and remove)");J=()=>[],pe=()=>{throw Error("@supabase/ssr: createBrowserClient in non-browser runtimes (including Next.js pre-rendering mode) was not initialized cookie options that specify getAll and setAll functions (deprecated: alternatively use get, set and remove), but they were needed")}}return Z?{getAll:J,setAll:pe,setItems:be,removedItems:me,storage:{isServer:!0,getItem:async D=>{if(typeof be[D]=="string")return be[D];if(me[D])return null;let H=await J([D]),z=await we(D,async Y=>{let ne=H?.find(({name:Oe})=>Oe===Y)||null;return ne?ne.value:null});if(!z)return null;let Q=z;return typeof z=="string"&&z.startsWith(m)&&(Q=L(z.substring(m.length))),Q},setItem:async(D,H)=>{D.endsWith("-code-verifier")&&await P({getAll:J,setAll:pe,setItems:{[D]:H},removedItems:{}},{cookieOptions:A?.cookieOptions??null,cookieEncoding:Te}),be[D]=H,delete me[D]},removeItem:async D=>{delete be[D],me[D]=!0}}}:{getAll:J,setAll:pe,setItems:be,removedItems:me,storage:{isServer:!1,getItem:async D=>{let H=await J([D]),z=await we(D,async Y=>{let ne=H?.find(({name:Oe})=>Oe===Y)||null;return ne?ne.value:null});if(!z)return null;let Q=z;return z.startsWith(m)&&(Q=L(z.substring(m.length))),Q},setItem:async(D,H)=>{let z=await J([D]),Q=new Set((z?.map(({name:Se})=>Se)||[]).filter(Se=>te(Se,D))),Y=H;Te==="base64url"&&(Y=m+X(H));let ne=fe(D,Y);ne.forEach(({name:Se})=>{Q.delete(Se)});let Oe={...ie,...A?.cookieOptions,maxAge:0},rt={...ie,...A?.cookieOptions,maxAge:ie.maxAge};delete Oe.name,delete rt.name;let ze=[...[...Q].map(Se=>({name:Se,value:"",options:Oe})),...ne.map(({name:Se,value:gt})=>({name:Se,value:gt,options:rt}))];ze.length>0&&await pe(ze)},removeItem:async D=>{let H=await J([D]),z=(H?.map(({name:Y})=>Y)||[]).filter(Y=>te(Y,D)),Q={...ie,...A?.cookieOptions,maxAge:0};delete Q.name,z.length>0&&await pe(z.map(Y=>({name:Y,value:"",options:Q})))}}}}({...T,cookieEncoding:T?.cookieEncoding??"base64url"},!0),N=(0,E.UU)(R,I,{...T,global:{...T?.global,headers:{...T?.global?.headers,"X-Client-Info":"supabase-ssr/0.8.0 createServerClient"}},auth:{...T?.cookieOptions?.name?{storageKey:T.cookieOptions.name}:null,...T?.auth,flowType:"pkce",autoRefreshToken:!1,detectSessionInUrl:!1,persistSession:!0,storage:_,...T?.cookies&&"encode"in T.cookies&&T.cookies.encode==="tokens-only"?{userStorage:T?.auth?.userStorage??function(A={}){return{getItem:Z=>A[Z]||null,setItem:(Z,J)=>{A[Z]=J},removeItem:Z=>{delete A[Z]}}}()}:null}});return N.auth.onAuthStateChange(async A=>{(Object.keys(S).length>0||Object.keys(x).length>0)&&(A==="SIGNED_IN"||A==="TOKEN_REFRESHED"||A==="USER_UPDATED"||A==="PASSWORD_RECOVERY"||A==="SIGNED_OUT"||A==="MFA_CHALLENGE_VERIFIED")&&await P({getAll:j,setAll:B,setItems:S,removedItems:x},{cookieOptions:T?.cookieOptions??null,cookieEncoding:T?.cookieEncoding??"base64url"})}),N}if("u">typeof process&&process.env?.npm_package_name){let R=process.env.npm_package_name;["@supabase/auth-helpers-nextjs","@supabase/auth-helpers-react","@supabase/auth-helpers-remix","@supabase/auth-helpers-sveltekit"].includes(R)&&console.warn(`
\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
\u2551 \u26A0\uFE0F  IMPORTANT: Package Consolidation Notice                                \u2551
\u2551                                                                            \u2551
\u2551 The ${R.padEnd(35)} package name is deprecated.  \u2551
\u2551                                                                            \u2551
\u2551 You are now using @supabase/ssr - a unified solution for all frameworks.  \u2551
\u2551                                                                            \u2551
\u2551 The auth-helpers packages have been consolidated into @supabase/ssr       \u2551
\u2551 to provide better maintenance and consistent APIs across frameworks.      \u2551
\u2551                                                                            \u2551
\u2551 Please update your package.json to use @supabase/ssr directly:            \u2551
\u2551   npm uninstall ${R.padEnd(42)} \u2551
\u2551   npm install @supabase/ssr                                               \u2551
\u2551                                                                            \u2551
\u2551 For more information, visit:                                              \u2551
\u2551 https://supabase.com/docs/guides/auth/server-side                         \u2551
\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D
    `)}},Ue.__chunk_1326=(Ve,ye,U)=>{U.d(ye,{UL:()=>X});var oe=U(1300),le=U(1519),ie=U(3926),he=U(4463),te=U(8540),fe=U(862),we=U(2867),V=U(3623),ue=U(7064),M=U(622);function X(){let P="cookies",E=ie.workAsyncStorage.getStore(),w=he.workUnitAsyncStorage.getStore();if(E){if(w&&w.phase==="after"&&!(0,ue.iC)())throw Object.defineProperty(Error(`Route ${E.route} used \`cookies()\` inside \`after()\`. This is not supported. If you need this data inside an \`after()\` callback, use \`cookies()\` outside of the callback. See more info here: https://nextjs.org/docs/canary/app/api-reference/functions/after`),"__NEXT_ERROR_CODE",{value:"E843",enumerable:!1,configurable:!0});if(E.forceStatic)return m(oe.Ck.seal(new le.tm(new Headers({}))));if(E.dynamicShouldError)throw Object.defineProperty(new fe.f(`Route ${E.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`cookies()\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E849",enumerable:!1,configurable:!0});if(w)switch(w.type){case"cache":let T=Object.defineProperty(Error(`Route ${E.route} used \`cookies()\` inside "use cache". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \`cookies()\` outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E831",enumerable:!1,configurable:!0});throw Error.captureStackTrace(T,X),E.invalidDynamicUsageError??=T,T;case"unstable-cache":throw Object.defineProperty(Error(`Route ${E.route} used \`cookies()\` inside a function cached with \`unstable_cache()\`. Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \`cookies()\` outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`),"__NEXT_ERROR_CODE",{value:"E846",enumerable:!1,configurable:!0});case"prerender":var R=E,I=w;let _=L.get(I);if(_)return _;let j=(0,we.W5)(I.renderSignal,R.route,"`cookies()`");return L.set(I,j),j;case"prerender-client":let B="`cookies`";throw Object.defineProperty(new M.z(`${B} must not be used within a Client Component. Next.js should be preventing ${B} from being included in Client Components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E832",enumerable:!1,configurable:!0});case"prerender-ppr":return(0,te.Ui)(E.route,P,w.dynamicTracking);case"prerender-legacy":return(0,te.xI)(P,E,w);case"prerender-runtime":return(0,te.wi)(w,m(w.cookies));case"private-cache":return m(w.cookies);case"request":return(0,te.Pk)(w),m((0,oe.Xj)(w)?w.userspaceMutableCookies:w.cookies)}}(0,he.throwForMissingRequestStore)(P)}U(6091);let L=new WeakMap;function m(P){let E=L.get(P);if(E)return E;let w=Promise.resolve(P);return L.set(P,w),w}(0,V.I)(function(P,E){let w=P?`Route "${P}" `:"This route ";return Object.defineProperty(Error(`${w}used ${E}. \`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E830",enumerable:!1,configurable:!0})}),U(5703),(0,V.I)(function(P,E){let w=P?`Route "${P}" `:"This route ";return Object.defineProperty(Error(`${w}used ${E}. \`headers()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E836",enumerable:!1,configurable:!0})}),U(2604),(0,V.I)(function(P,E){let w=P?`Route "${P}" `:"This route ";return Object.defineProperty(Error(`${w}used ${E}. \`draftMode()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E835",enumerable:!1,configurable:!0})})},Ue.__chunk_1300=(Ve,ye,U)=>{U.d(ye,{K8:()=>V,Ck:()=>te,IN:()=>we,Xj:()=>M,EJ:()=>ue});var oe=U(1519),le=U(5288),ie=U(3926);class he extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#options")}static callable(){throw new he}}class te{static seal(m){return new Proxy(m,{get(P,E,w){switch(E){case"clear":case"delete":case"set":return he.callable;default:return le.l.get(P,E,w)}}})}}let fe=Symbol.for("next.mutated.cookies");function we(L,m){let P,E=(P=m[fe])&&Array.isArray(P)&&P.length!==0?P:[];if(E.length===0)return!1;let w=new oe.VO(L),R=w.getAll();for(let I of E)w.set(I);for(let I of R)w.set(I);return!0}class V{static wrap(m,P){let E=new oe.VO(new Headers);for(let _ of m.getAll())E.set(_);let w=[],R=new Set,I=()=>{let _=ie.workAsyncStorage.getStore();if(_&&(_.pathWasRevalidated=1),w=E.getAll().filter(j=>R.has(j.name)),P){let j=[];for(let B of w){let S=new oe.VO(new Headers);S.set(B),j.push(S.toString())}P(j)}},T=new Proxy(E,{get(_,j,B){switch(j){case fe:return w;case"delete":return function(...S){R.add(typeof S[0]=="string"?S[0]:S[0].name);try{return _.delete(...S),T}finally{I()}};case"set":return function(...S){R.add(typeof S[0]=="string"?S[0]:S[0].name);try{return _.set(...S),T}finally{I()}};default:return le.l.get(_,j,B)}}});return T}}function ue(L){let m=new Proxy(L.mutableCookies,{get(P,E,w){switch(E){case"delete":return function(...R){return X(L,"cookies().delete"),P.delete(...R),m};case"set":return function(...R){return X(L,"cookies().set"),P.set(...R),m};default:return le.l.get(P,E,w)}}});return m}function M(L){return L.phase==="action"}function X(L,m){if(!M(L))throw new he}},Ue);export{qs as __getNamedExports};
